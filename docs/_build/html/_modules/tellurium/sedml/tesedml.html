

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>tellurium.sedml.tesedml &mdash; tellurium 1.3.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="tellurium 1.3.1 documentation" href="../../../index.html"/>
        <link rel="up" title="Module code" href="../../index.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> tellurium
          

          
          </a>

          
            
            
              <div class="version">
                1.3.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebooks.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tellurium_methods.html">Tellurium Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_apidoc/tellurium.html">API (tellurium)</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">tellurium</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      
    <li>tellurium.sedml.tesedml</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for tellurium.sedml.tesedml</h1><div class="highlight"><pre>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Tellurium SED-ML support.</span>

<span class="sd">This module implements SED-ML L1V2 support for tellurium.</span>
<span class="sd">In the current implementation all SED-ML constructs with exception of</span>
<span class="sd">    XML transformation changes of the model</span>
<span class="sd">        - Change.RemoveXML</span>
<span class="sd">        - Change.AddXML</span>
<span class="sd">        - Change.ChangeXML</span>
<span class="sd">are supported.</span>

<span class="sd">SBML models are fully supported, whereas for CellML models only basic support</span>
<span class="sd">is implemented (when additional support is requested it be implemented).</span>
<span class="sd">CellML models are transformed to SBML models which results in different XPath expressions,</span>
<span class="sd">so that targets, selections cannot be easily resolved in the CellMl-SBML.</span>

<span class="sd">Supported input for SED-ML are either SED-ML files (&#39;.sedml&#39; extension),</span>
<span class="sd">SED-ML XML strings or archives (&#39;.sedx&#39;|&#39;.omex&#39; extension).</span>
<span class="sd">Executable python code is generated from the SED-ML which allows the</span>
<span class="sd">execution of the defined simulation experiment.</span>

<span class="sd">SED-ML is build of five main classes</span>
<span class="sd">    the Model Class,</span>
<span class="sd">    the Simulation Class,</span>
<span class="sd">    the Task Class,</span>
<span class="sd">    the DataGenerator Class,</span>
<span class="sd">    and the Output Class.</span>

<span class="sd">The Model Class</span>
<span class="sd">    The Model class is used to reference the models used in the simulation experiment.</span>
<span class="sd">    SED-ML itself is independent of the model encoding underlying the models. The only</span>
<span class="sd">    requirement is that the model needs to be referenced by using an unambiguous identifier</span>
<span class="sd">    which allows for finding it, for example using a MIRIAM URI. To specify the language in</span>
<span class="sd">    which the model is encoded, a set of predefined language URNs is provided.</span>
<span class="sd">    The SED-ML Change class allows the application of changes to the referenced models,</span>
<span class="sd">    including changes on the XML attributes, e.g. changing the value of an observable,</span>
<span class="sd">    computing the change of a value using mathematics, or general changes on any XML element</span>
<span class="sd">    of the model representation that is addressable by XPath expressions, e.g. substituting</span>
<span class="sd">    a piece of XML by an updated one.</span>

<span class="sd">The Simulation Class</span>
<span class="sd">    The Simulation class defines the simulation settings and the steps taken during simulation.</span>
<span class="sd">    These include the particular type of simulation and the algorithm used for the execution of</span>
<span class="sd">    the simulation; preferably an unambiguous reference to such an algorithm should be given,</span>
<span class="sd">    using a controlled vocabulary, or ontologies. One example for an ontology of simulation</span>
<span class="sd">    algorithms is the Kinetic Simulation Algorithm Ontology KiSAO. Further information encodable</span>
<span class="sd">    in the Simulation class includes the step size, simulation duration, and other</span>
<span class="sd">    simulation-type dependent information.</span>

<span class="sd">The Task Class</span>
<span class="sd">    SED-ML makes use of the notion of a Task class to combine a defined model (from the Model class)</span>
<span class="sd">    and a defined simulation setting (from the Simulation class). A task always holds one reference each.</span>
<span class="sd">    To refer to a specific model and to a specific simulation, the corresponding IDs are used.</span>

<span class="sd">The DataGenerator Class</span>
<span class="sd">    The raw simulation result sometimes does not correspond to the desired output of the simulation,</span>
<span class="sd">    e.g. one might want to normalise a plot before output, or apply post-processing like mean-value calculation.</span>
<span class="sd">    The DataGenerator class allows for the encoding of such post-processings which need to be applied to the</span>
<span class="sd">    simulation result before output. To define data generators, any addressable variable or parameter</span>
<span class="sd">    of any defined model (from instances of the Model class) may be referenced, and new entities might</span>
<span class="sd">    be specified using MathML definitions.</span>

<span class="sd">The Output Class</span>
<span class="sd">    The Output class defines the output of the simulation, in the sense that it specifies what shall be</span>
<span class="sd">    plotted in the output. To do so, an output type is defined, e.g. 2D-plot, 3D-plot or data table,</span>
<span class="sd">    and the according axes or columns are all assigned to one of the formerly specified instances</span>
<span class="sd">    of the DataGenerator class.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># TODO: implement full resolving of xpath expressions (target, selection) (see xpath.py for example)</span>
<span class="c1"># TODO: implement XML changes</span>
<span class="c1"># TODO: implement full concatenation of subtasks</span>
<span class="c1"># TODO: better handling of model.reset for task tree</span>

<span class="c1"># FIXME: bug multiple model instances of same model (https://github.com/sys-bio/roadrunner/issues/305)</span>
<span class="c1"># FIXME: bug missing .xml extension in model source in combine archive (https://sourceforge.net/p/phrasedml/tickets/15/)</span>
<span class="c1"># FIXME: rk4 integration not working on linux (https://github.com/sys-bio/roadrunner/issues/307)</span>


<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">division</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">zipfile</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">jinja2</span> <span class="kn">import</span> <span class="n">Environment</span><span class="p">,</span> <span class="n">FileSystemLoader</span>
<span class="kn">from</span> <span class="nn">mathml</span> <span class="kn">import</span> <span class="n">evaluableMathML</span>

<span class="kn">import</span> <span class="nn">libsedml</span>

<span class="kn">import</span> <span class="nn">tellurium</span> <span class="kn">as</span> <span class="nn">te</span>
<span class="kn">from</span> <span class="nn">tellurium.tecombine</span> <span class="kn">import</span> <span class="n">CombineTools</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># requrired imports within generated code</span>
    <span class="kn">import</span> <span class="nn">pandas</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
    <span class="kn">import</span> <span class="nn">mpl_toolkits.mplot3d</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Dependencies for SEDML code execution not fullfilled.&quot;</span><span class="p">)</span>


<span class="c1">######################################################################################################################</span>

<div class="viewcode-block" id="sedml_to_python"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.sedml_to_python">[docs]</a><span class="k">def</span> <span class="nf">sedml_to_python</span><span class="p">(</span><span class="nb">input</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Convert sedml file to python code.</span>

<span class="sd">    Deprecated: use sedmlToPython()</span>

<span class="sd">    :param inputstring:</span>
<span class="sd">    :type inputstring:</span>
<span class="sd">    :return:</span>
<span class="sd">    :rtype:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Use sedmlToPython instead, will be removed in v1.4&#39;</span><span class="p">,</span>
                  <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sedmlToPython</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span></div>


<div class="viewcode-block" id="sedmlToPython"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.sedmlToPython">[docs]</a><span class="k">def</span> <span class="nf">sedmlToPython</span><span class="p">(</span><span class="n">inputStr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Convert sedml file to python code.</span>

<span class="sd">    :param inputstring: full path name to SedML model or SED-ML string</span>
<span class="sd">    :type inputstring: path</span>
<span class="sd">    :return: contents</span>
<span class="sd">    :rtype:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO: necessary to select SEDML files from archive (i.e. if multiple files)</span>
    <span class="n">factory</span> <span class="o">=</span> <span class="n">SEDMLCodeFactory</span><span class="p">(</span><span class="n">inputStr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">factory</span><span class="o">.</span><span class="n">toPython</span><span class="p">()</span></div>


<div class="viewcode-block" id="executeSEDML"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.executeSEDML">[docs]</a><span class="k">def</span> <span class="nf">executeSEDML</span><span class="p">(</span><span class="n">inputStr</span><span class="p">,</span> <span class="n">workingDir</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Run a SED-ML file or archive.</span>

<span class="sd">    If a workingDir is provided the files and results are written in the workingDir.</span>

<span class="sd">    :param inputStr:</span>
<span class="sd">    :type inputStr:</span>
<span class="sd">    :return:</span>
<span class="sd">    :rtype:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># execute the sedml</span>
    <span class="n">factory</span> <span class="o">=</span> <span class="n">SEDMLCodeFactory</span><span class="p">(</span><span class="n">inputStr</span><span class="p">,</span> <span class="n">workingDir</span><span class="o">=</span><span class="n">workingDir</span><span class="p">)</span>
    <span class="n">factory</span><span class="o">.</span><span class="n">executePython</span><span class="p">()</span></div>


<span class="c1">######################################################################################################################</span>
<span class="c1"># KISAO MAPPINGS</span>
<span class="c1">######################################################################################################################</span>

<span class="n">KISAOS_CVODE</span> <span class="o">=</span> <span class="p">[</span>  <span class="c1"># &#39;cvode&#39;</span>
    <span class="s1">&#39;KISAO:0000019&#39;</span><span class="p">,</span>  <span class="c1"># CVODE</span>
    <span class="s1">&#39;KISAO:0000433&#39;</span><span class="p">,</span>  <span class="c1"># CVODE-like method</span>
    <span class="s1">&#39;KISAO:0000407&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000099&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000035&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000071&#39;</span><span class="p">,</span>
    <span class="s2">&quot;KISAO:0000288&quot;</span><span class="p">,</span>  <span class="c1"># &quot;BDF&quot; cvode, stiff=true</span>
    <span class="s2">&quot;KISAO:0000280&quot;</span><span class="p">,</span>  <span class="c1"># &quot;Adams-Moulton&quot; cvode, stiff=false</span>
<span class="p">]</span>

<span class="n">KISAOS_RK4</span> <span class="o">=</span> <span class="p">[</span>  <span class="c1"># &#39;rk4&#39;</span>
    <span class="s1">&#39;KISAO:0000032&#39;</span><span class="p">,</span>  <span class="c1"># RK4 explicit fourth-order Runge-Kutta method</span>
<span class="p">]</span>

<span class="n">KISAOS_RK45</span> <span class="o">=</span> <span class="p">[</span>  <span class="c1"># &#39;rk45&#39;</span>
    <span class="s1">&#39;KISAO:0000435&#39;</span><span class="p">,</span>  <span class="c1"># RK45 embedded Runge-Kutta 5(4) method</span>
    <span class="s1">&#39;KISAO_0000064&#39;</span><span class="p">,</span>  <span class="c1"># Runge-Kutta based method</span>
<span class="p">]</span>

<span class="n">KISAOS_GILLESPIE</span> <span class="o">=</span> <span class="p">[</span>  <span class="c1"># &#39;gillespie&#39;</span>
    <span class="s1">&#39;KISAO:0000241&#39;</span><span class="p">,</span>  <span class="c1"># Gillespie-like method</span>
    <span class="s1">&#39;KISAO:0000029&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000319&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000274&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000333&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000329&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000323&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000331&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000027&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000082&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000324&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000350&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000330&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000028&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000038&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000039&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000048&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000074&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000081&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000045&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000351&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000084&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000040&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000046&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000003&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000051&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000335&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000336&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000095&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000022&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000076&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000015&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000075&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000278&#39;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">KISAOS_NLEQ</span> <span class="o">=</span> <span class="p">[</span>  <span class="c1"># &#39;nleq&#39;</span>
    <span class="s1">&#39;KISAO:0000099&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000274&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000282&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000283&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000355&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000356&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000407&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000408&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000409&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000410&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000411&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000412&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000413&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000432&#39;</span><span class="p">,</span>
    <span class="s1">&#39;KISAO:0000437&#39;</span><span class="p">,</span>
<span class="p">]</span>

<span class="c1"># allowed algorithms for simulation type</span>
<span class="n">KISAOS_STEADYSTATE</span> <span class="o">=</span> <span class="n">KISAOS_NLEQ</span>
<span class="n">KISAOS_UNIFORMTIMECOURSE</span> <span class="o">=</span> <span class="n">KISAOS_CVODE</span> <span class="o">+</span> <span class="n">KISAOS_RK4</span> <span class="o">+</span> <span class="n">KISAOS_RK45</span> <span class="o">+</span> <span class="n">KISAOS_GILLESPIE</span>
<span class="n">KISAOS_ONESTEP</span> <span class="o">=</span> <span class="n">KISAOS_UNIFORMTIMECOURSE</span>

<span class="c1"># supported algorithm parameters</span>
<span class="n">KISAOS_ALGORITHMPARAMETERS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;KISAO:0000209&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;relative_tolerance&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>  <span class="c1"># the relative tolerance</span>
    <span class="s1">&#39;KISAO:0000211&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;absolute_tolerance&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>  <span class="c1"># the absolute tolerance</span>
    <span class="s1">&#39;KISAO:0000220&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;maximum_bdf_order&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>  <span class="c1"># the maximum BDF (stiff) order</span>
    <span class="s1">&#39;KISAO:0000219&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;maximum_adams_order&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>  <span class="c1"># the maximum Adams (non-stiff) order</span>
    <span class="s1">&#39;KISAO:0000415&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;maximum_num_steps&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>  <span class="c1"># the maximum number of steps that can be taken before exiting</span>
    <span class="s1">&#39;KISAO:0000467&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;maximum_time_step&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>  <span class="c1"># the maximum time step that can be taken</span>
    <span class="s1">&#39;KISAO:0000485&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;minimum_time_step&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>  <span class="c1"># the minimum time step that can be taken</span>
    <span class="s1">&#39;KISAO:0000332&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;initial_time_step&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>  <span class="c1"># the initial value of the time step for algorithms that change this value</span>
    <span class="s1">&#39;KISAO:0000107&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;variable_step_size&#39;</span><span class="p">,</span> <span class="nb">bool</span><span class="p">),</span>  <span class="c1"># whether or not the algorithm proceeds with an adaptive step size or not</span>
    <span class="s1">&#39;KISAO:0000486&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;maximum_iterations&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>  <span class="c1"># [nleq] the maximum number of iterations the algorithm should take before exiting</span>
    <span class="s1">&#39;KISAO:0000487&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;minimum_damping&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>  <span class="c1"># [nleq] minimum damping value</span>
    <span class="s1">&#39;KISAO:0000488&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;seed&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>  <span class="c1"># the seed for stochastic runs of the algorithm</span>
<span class="p">}</span>
<span class="c1">######################################################################################################################</span>

<div class="viewcode-block" id="SEDMLCodeFactory"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.SEDMLCodeFactory">[docs]</a><span class="k">class</span> <span class="nc">SEDMLCodeFactory</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Code Factory generating executable code.&quot;&quot;&quot;</span>

    <span class="c1"># template location</span>
    <span class="n">TEMPLATE_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">__file__</span><span class="p">)),</span> <span class="s1">&#39;templates&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputStr</span><span class="p">,</span> <span class="n">workingDir</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create CodeFactory for given input.</span>
<span class="sd">        :param inputStr:</span>
<span class="sd">        :type inputStr:</span>
<span class="sd">        :return:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputStr</span> <span class="o">=</span> <span class="n">inputStr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">workingDir</span> <span class="o">=</span> <span class="n">workingDir</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">SEDMLTools</span><span class="o">.</span><span class="n">readSEDMLDocument</span><span class="p">(</span><span class="n">inputStr</span><span class="p">,</span> <span class="n">workingDir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doc</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;doc&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputType</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;inputType&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">workingDir</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;workingDir&#39;</span><span class="p">]</span>

        <span class="c1"># parse the models (resolve the source models &amp; the applied changes for all models)</span>
        <span class="n">model_sources</span><span class="p">,</span> <span class="n">model_changes</span> <span class="o">=</span> <span class="n">SEDMLTools</span><span class="o">.</span><span class="n">resolveModelChanges</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_sources</span> <span class="o">=</span> <span class="n">model_sources</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_changes</span> <span class="o">=</span> <span class="n">model_changes</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Print Input</span>
<span class="sd">        :return:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">),</span>
            <span class="s1">&#39;doc: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doc</span><span class="p">),</span>
            <span class="s1">&#39;workingDir: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workingDir</span><span class="p">),</span>
            <span class="s1">&#39;inputType: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputType</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputType</span> <span class="o">!=</span> <span class="n">SEDMLTools</span><span class="o">.</span><span class="n">INPUT_TYPE_STR</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;input: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputStr</span><span class="p">))</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

<div class="viewcode-block" id="SEDMLCodeFactory.sedmlString"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.SEDMLCodeFactory.sedmlString">[docs]</a>    <span class="k">def</span> <span class="nf">sedmlString</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get the SEDML XML string of the current document.</span>

<span class="sd">        :return: SED-ML XML</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">libsedml</span><span class="o">.</span><span class="n">writeSedMLToString</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doc</span><span class="p">)</span></div>

<div class="viewcode-block" id="SEDMLCodeFactory.toPython"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.SEDMLCodeFactory.toPython">[docs]</a>    <span class="k">def</span> <span class="nf">toPython</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">python_template</span><span class="o">=</span><span class="s1">&#39;tesedml_template.template&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create python code by rendering the python template.</span>
<span class="sd">        Uses the information in the SED-ML document to create</span>
<span class="sd">        python code</span>

<span class="sd">        Renders the respective template.</span>

<span class="sd">        :return: returns the rendered template</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># template environment</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span><span class="n">loader</span><span class="o">=</span><span class="n">FileSystemLoader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TEMPLATE_DIR</span><span class="p">),</span>
                          <span class="n">extensions</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;jinja2.ext.autoescape&#39;</span><span class="p">],</span>
                          <span class="n">trim_blocks</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                          <span class="n">lstrip_blocks</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="c1"># additional filters</span>
        <span class="c1"># for key in sedmlfilters.filters:</span>
        <span class="c1">#      env.filters[key] = getattr(sedmlfilters, key)</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="n">python_template</span><span class="p">)</span>
        <span class="n">env</span><span class="o">.</span><span class="n">globals</span><span class="p">[</span><span class="s1">&#39;modelToPython&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelToPython</span>
        <span class="n">env</span><span class="o">.</span><span class="n">globals</span><span class="p">[</span><span class="s1">&#39;taskToPython&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">taskToPython</span>
        <span class="n">env</span><span class="o">.</span><span class="n">globals</span><span class="p">[</span><span class="s1">&#39;dataGeneratorToPython&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataGeneratorToPython</span>
        <span class="n">env</span><span class="o">.</span><span class="n">globals</span><span class="p">[</span><span class="s1">&#39;outputToPython&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputToPython</span>

        <span class="c1"># timestamp</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S&#39;</span><span class="p">)</span>

        <span class="c1"># Context</span>
        <span class="n">c</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="n">te</span><span class="o">.</span><span class="n">getTelluriumVersion</span><span class="p">(),</span>
            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
            <span class="s1">&#39;factory&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="p">,</span>
            <span class="s1">&#39;doc&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc</span><span class="p">,</span>
            <span class="s1">&#39;model_sources&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_sources</span><span class="p">,</span>
            <span class="s1">&#39;model_changes&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_changes</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pysedml</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># something went wrong in the conversion to python</span>
            <span class="c1"># show detailed information about the factory</span>
            <span class="c1"># and the libsedml document</span>
            <span class="c1"># msg = e.message + &#39;\n&#39; + self.__str__() + &#39;\n&#39; + libsedml.writeSedMLToString(self.doc) + &#39;\n&#39;</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">message</span>
            <span class="k">raise</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)(</span><span class="n">msg</span><span class="p">),</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">pysedml</span></div>

<div class="viewcode-block" id="SEDMLCodeFactory.executePython"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.SEDMLCodeFactory.executePython">[docs]</a>    <span class="k">def</span> <span class="nf">executePython</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Executes python code.</span>

<span class="sd">        The python code is created during the function call.</span>
<span class="sd">        See :func:`createpython`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">execStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">toPython</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># This calls exec. Be very sure that nothing bad happens here.</span>
            <span class="k">exec</span> <span class="n">execStr</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># something went wrong in the conversion to python</span>
            <span class="c1"># show detailed information about the factory</span>
            <span class="c1"># and the libsedml document</span>
            <span class="k">raise</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">80</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                                   <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__str__</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                                   <span class="o">+</span> <span class="s1">&#39;*&#39;</span><span class="o">*</span><span class="mi">80</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                                   <span class="o">+</span> <span class="n">execStr</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                                   <span class="o">+</span> <span class="s1">&#39;*&#39;</span><span class="o">*</span><span class="mi">80</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                                   <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="n">message</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                                   <span class="p">),</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span></div>

<div class="viewcode-block" id="SEDMLCodeFactory.modelToPython"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.SEDMLCodeFactory.modelToPython">[docs]</a>    <span class="k">def</span> <span class="nf">modelToPython</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Python code for SedModel.</span>

<span class="sd">        :param model: SedModel instance</span>
<span class="sd">        :type model: SedModel</span>
<span class="sd">        :return: python str</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">mid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
        <span class="n">language</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">getLanguage</span><span class="p">()</span>
        <span class="n">source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_sources</span><span class="p">[</span><span class="n">mid</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">isUrn</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">source</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;urn&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">source</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;URN&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">isHttp</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">source</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">source</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;HTTP&#39;</span><span class="p">)</span>

        <span class="c1"># read SBML</span>
        <span class="k">if</span> <span class="s1">&#39;sbml&#39;</span> <span class="ow">in</span> <span class="n">language</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">isUrn</span><span class="p">():</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;import tellurium.temiriam as temiriam&quot;</span><span class="p">)</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;__{}_sbml = temiriam.getSBMLFromBiomodelsURN(&#39;{}&#39;)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="n">source</span><span class="p">))</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;{} = te.loadSBMLModel(__{}_sbml)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="n">mid</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">isHttp</span><span class="p">():</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;{} = te.loadSBMLModel(&#39;{}&#39;)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="n">source</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># FIXME: this is a bug in how the combine archive is created (missing .xml)</span>
                <span class="c1"># SHOULD NOT BE REQUIRED HERE. THIS IS A TEMPORARY FIX</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">source</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.xml&#39;</span><span class="p">):</span>
                    <span class="n">source</span> <span class="o">+=</span> <span class="s1">&#39;.xml&#39;</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;{} = te.loadSBMLModel(os.path.join(workingDir, &#39;{}&#39;))&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="n">source</span><span class="p">))</span>
        <span class="c1"># read CellML</span>
        <span class="k">elif</span> <span class="s1">&#39;cellml&#39;</span> <span class="ow">in</span> <span class="n">language</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">isHttp</span><span class="p">():</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;{} = te.loadCellMLModel(&#39;{}&#39;)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="n">source</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;{} = te.loadCellMLModel(os.path.join(workingDir, &#39;{}&#39;))&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_sources</span><span class="p">[</span><span class="n">mid</span><span class="p">]))</span>
        <span class="c1"># other</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Unsupported model language:&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">language</span><span class="p">))</span>

        <span class="c1"># apply model changes</span>
        <span class="k">for</span> <span class="n">change</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_changes</span><span class="p">[</span><span class="n">mid</span><span class="p">]:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">SEDMLCodeFactory</span><span class="o">.</span><span class="n">modelChangeToPython</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">change</span><span class="p">))</span>

        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SEDMLCodeFactory.modelChangeToPython"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.SEDMLCodeFactory.modelChangeToPython">[docs]</a>    <span class="k">def</span> <span class="nf">modelChangeToPython</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Creates the apply change python string for given model and change.</span>

<span class="sd">        Currently only a very limited subset of model changes is supported.</span>
<span class="sd">        Namely changes of parameters and concentrations within a SedChangeAttribute.</span>

<span class="sd">        :param model: given model</span>
<span class="sd">        :type model: SedModel</span>
<span class="sd">        :param change: model change</span>
<span class="sd">        :type change: SedChange</span>
<span class="sd">        :return:</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">mid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
        <span class="n">xpath</span> <span class="o">=</span> <span class="n">change</span><span class="o">.</span><span class="n">getTarget</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">change</span><span class="o">.</span><span class="n">getTypeCode</span><span class="p">()</span> <span class="o">==</span> <span class="n">libsedml</span><span class="o">.</span><span class="n">SEDML_CHANGE_ATTRIBUTE</span><span class="p">:</span>
            <span class="c1"># resolve target change</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">change</span><span class="o">.</span><span class="n">getNewValue</span><span class="p">()</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;# {} {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xpath</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SEDMLCodeFactory</span><span class="o">.</span><span class="n">targetToPython</span><span class="p">(</span><span class="n">xpath</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">modelId</span><span class="o">=</span><span class="n">mid</span><span class="p">))</span>

        <span class="k">elif</span> <span class="n">change</span><span class="o">.</span><span class="n">getTypeCode</span><span class="p">()</span> <span class="o">==</span> <span class="n">libsedml</span><span class="o">.</span><span class="n">SEDML_CHANGE_COMPUTECHANGE</span><span class="p">:</span>
            <span class="n">variables</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="n">change</span><span class="o">.</span><span class="n">getListOfParameters</span><span class="p">():</span>
                <span class="n">variables</span><span class="p">[</span><span class="n">par</span><span class="o">.</span><span class="n">getId</span><span class="p">()]</span> <span class="o">=</span> <span class="n">par</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">change</span><span class="o">.</span><span class="n">getListOfVariables</span><span class="p">():</span>
                <span class="n">vid</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
                <span class="n">selection</span> <span class="o">=</span> <span class="n">SEDMLCodeFactory</span><span class="o">.</span><span class="n">resolveSelectionFromVariable</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;species&quot;</span><span class="p">:</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;__var__{} = {}[&#39;[{}]&#39;]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vid</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">selection</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;__var__{} = {}[&#39;{}&#39;]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vid</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">selection</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
                <span class="n">variables</span><span class="p">[</span><span class="n">vid</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;__var__{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vid</span><span class="p">)</span>

            <span class="c1"># value is calculated with the current state of model</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">evaluableMathML</span><span class="p">(</span><span class="n">change</span><span class="o">.</span><span class="n">getMath</span><span class="p">(),</span> <span class="n">variables</span><span class="o">=</span><span class="n">variables</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SEDMLCodeFactory</span><span class="o">.</span><span class="n">targetToPython</span><span class="p">(</span><span class="n">xpath</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">modelId</span><span class="o">=</span><span class="n">mid</span><span class="p">))</span>

        <span class="k">elif</span> <span class="n">change</span><span class="o">.</span><span class="n">getTypeCode</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="n">libsedml</span><span class="o">.</span><span class="n">SEDML_CHANGE_REMOVEXML</span><span class="p">,</span>
                                      <span class="n">libsedml</span><span class="o">.</span><span class="n">SEDML_CHANGE_ADDXML</span><span class="p">,</span>
                                      <span class="n">libsedml</span><span class="o">.</span><span class="n">SEDML_CHANGE_CHANGEXML</span><span class="p">]:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;# Unsupported change: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">change</span><span class="o">.</span><span class="n">getElementName</span><span class="p">()))</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Unsupported change: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">change</span><span class="o">.</span><span class="n">getElementName</span><span class="p">()))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;# Unsupported change: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">change</span><span class="o">.</span><span class="n">getElementName</span><span class="p">()))</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Unsupported change: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">change</span><span class="o">.</span><span class="n">getElementName</span><span class="p">()))</span>

        <span class="k">return</span> <span class="n">lines</span></div>

    <span class="c1">################################################################################################</span>
    <span class="c1"># Here the main work is done,</span>
    <span class="c1"># transformation of tasks to python code</span>
    <span class="c1">################################################################################################</span>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SEDMLCodeFactory.taskToPython"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.SEDMLCodeFactory.taskToPython">[docs]</a>    <span class="k">def</span> <span class="nf">taskToPython</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">task</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create python for arbitrary task (repeated or simple).</span>

<span class="sd">        :param doc:</span>
<span class="sd">        :type doc:</span>
<span class="sd">        :param task:</span>
<span class="sd">        :type task:</span>
<span class="sd">        :return:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If no DataGenerator references the task, no execution is necessary</span>
        <span class="n">dgs</span> <span class="o">=</span> <span class="n">SEDMLCodeFactory</span><span class="o">.</span><span class="n">getDataGeneratorsForTask</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">task</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dgs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;# not part of any DataGenerator: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">getId</span><span class="p">())</span>

        <span class="c1"># tasks contain other subtasks, which can contain subtasks. This</span>
        <span class="c1"># results in a tree of task dependencies where the</span>
        <span class="c1"># simple tasks are the node leaves. These tree has to be resolved to</span>
        <span class="c1"># generate code for more complex task dependencies.</span>

        <span class="c1"># resolve task tree (order &amp; dependency of tasks) &amp; generate code</span>
        <span class="n">taskTree</span> <span class="o">=</span> <span class="n">SEDMLCodeFactory</span><span class="o">.</span><span class="n">createTaskTree</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">rootTask</span><span class="o">=</span><span class="n">task</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">SEDMLCodeFactory</span><span class="o">.</span><span class="n">taskTreeToPython</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">tree</span><span class="o">=</span><span class="n">taskTree</span><span class="p">)</span></div>

<div class="viewcode-block" id="SEDMLCodeFactory.TaskNode"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.SEDMLCodeFactory.TaskNode">[docs]</a>    <span class="k">class</span> <span class="nc">TaskNode</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Tree implementation of task tree. &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">,</span> <span class="n">depth</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">task</span> <span class="o">=</span> <span class="n">task</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="n">depth</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">None</span>

<div class="viewcode-block" id="SEDMLCodeFactory.TaskNode.add_child"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.SEDMLCodeFactory.TaskNode.add_child">[docs]</a>        <span class="k">def</span> <span class="nf">add_child</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span></div>

<div class="viewcode-block" id="SEDMLCodeFactory.TaskNode.is_leaf"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.SEDMLCodeFactory.TaskNode.is_leaf">[docs]</a>        <span class="k">def</span> <span class="nf">is_leaf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span></div>

        <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&lt;[{}] {} ({})&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">getElementName</span><span class="p">())]</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="n">child_str</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">__str__</span><span class="p">()</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">child_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)])</span>
            <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

<div class="viewcode-block" id="SEDMLCodeFactory.TaskNode.info"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.SEDMLCodeFactory.TaskNode.info">[docs]</a>        <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;&lt;[{}] {} ({})&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">getElementName</span><span class="p">())</span></div>

        <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; Depth-first iterator which yields TaskNodes.&quot;&quot;&quot;</span>
            <span class="k">yield</span> <span class="bp">self</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">child</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">node</span></div>

<div class="viewcode-block" id="SEDMLCodeFactory.Stack"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.SEDMLCodeFactory.Stack">[docs]</a>    <span class="k">class</span> <span class="nc">Stack</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Stack implementation for nodes.&quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="SEDMLCodeFactory.Stack.isEmpty"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.SEDMLCodeFactory.Stack.isEmpty">[docs]</a>        <span class="k">def</span> <span class="nf">isEmpty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">==</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="SEDMLCodeFactory.Stack.push"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.SEDMLCodeFactory.Stack.push">[docs]</a>        <span class="k">def</span> <span class="nf">push</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span></div>

<div class="viewcode-block" id="SEDMLCodeFactory.Stack.pop"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.SEDMLCodeFactory.Stack.pop">[docs]</a>        <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span></div>

<div class="viewcode-block" id="SEDMLCodeFactory.Stack.peek"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.SEDMLCodeFactory.Stack.peek">[docs]</a>        <span class="k">def</span> <span class="nf">peek</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="SEDMLCodeFactory.Stack.size"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.SEDMLCodeFactory.Stack.size">[docs]</a>        <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span></div>

        <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;stack: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">([</span><span class="n">item</span><span class="o">.</span><span class="n">info</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">])</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SEDMLCodeFactory.createTaskTree"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.SEDMLCodeFactory.createTaskTree">[docs]</a>    <span class="k">def</span> <span class="nf">createTaskTree</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">rootTask</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Creates the task tree.</span>
<span class="sd">        Required for resolution of order of all simulations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">add_children</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
            <span class="n">typeCode</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">getTypeCode</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">typeCode</span> <span class="o">==</span> <span class="n">libsedml</span><span class="o">.</span><span class="n">SEDML_TASK</span><span class="p">:</span>
                <span class="k">return</span>  <span class="c1"># no children</span>
            <span class="k">elif</span> <span class="n">typeCode</span> <span class="o">==</span> <span class="n">libsedml</span><span class="o">.</span><span class="n">SEDML_TASK_REPEATEDTASK</span><span class="p">:</span>
                <span class="c1"># add the ordered list of subtasks as children</span>
                <span class="n">subtasks</span> <span class="o">=</span> <span class="n">SEDMLCodeFactory</span><span class="o">.</span><span class="n">getOrderedSubtasks</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">task</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">st</span> <span class="ow">in</span> <span class="n">subtasks</span><span class="p">:</span>
                    <span class="c1"># get real task for subtask</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">getTask</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">getTask</span><span class="p">())</span>
                    <span class="n">child</span> <span class="o">=</span> <span class="n">SEDMLCodeFactory</span><span class="o">.</span><span class="n">TaskNode</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">depth</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
                    <span class="c1"># recursive adding of children</span>
                    <span class="n">add_children</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Unsupported task type: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">getElementName</span><span class="p">()))</span>

        <span class="c1"># create root</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">SEDMLCodeFactory</span><span class="o">.</span><span class="n">TaskNode</span><span class="p">(</span><span class="n">rootTask</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># recursive adding of children</span>
        <span class="n">add_children</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">root</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SEDMLCodeFactory.getOrderedSubtasks"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.SEDMLCodeFactory.getOrderedSubtasks">[docs]</a>    <span class="k">def</span> <span class="nf">getOrderedSubtasks</span><span class="p">(</span><span class="n">task</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Ordered list of subtasks for task.&quot;&quot;&quot;</span>
        <span class="n">subtasks</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">getListOfSubTasks</span><span class="p">()</span>
        <span class="n">subtaskOrder</span> <span class="o">=</span> <span class="p">[</span><span class="n">st</span><span class="o">.</span><span class="n">getOrder</span><span class="p">()</span> <span class="k">for</span> <span class="n">st</span> <span class="ow">in</span> <span class="n">subtasks</span><span class="p">]</span>
        <span class="c1"># sort by order, if all subtasks have order (not required)</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">subtaskOrder</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">subtasks</span> <span class="o">=</span> <span class="p">[</span><span class="n">st</span> <span class="k">for</span> <span class="p">(</span><span class="n">stOrder</span><span class="p">,</span> <span class="n">st</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">subtaskOrder</span><span class="p">,</span> <span class="n">subtasks</span><span class="p">))]</span>
        <span class="k">return</span> <span class="n">subtasks</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SEDMLCodeFactory.taskTreeToPython"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.SEDMLCodeFactory.taskTreeToPython">[docs]</a>    <span class="k">def</span> <span class="nf">taskTreeToPython</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">tree</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Python code generation from task tree. &quot;&quot;&quot;</span>
        <span class="c1"># print(tree)</span>

        <span class="c1"># TODO: implement the merge of subtasks &amp; and collection of simulations</span>

        <span class="c1"># go forward through task tree</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">nodeStack</span> <span class="o">=</span> <span class="n">SEDMLCodeFactory</span><span class="o">.</span><span class="n">Stack</span><span class="p">()</span>
        <span class="n">treeNodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">tree</span><span class="p">]</span>

        <span class="c1"># iterate over the tree</span>
        <span class="k">for</span> <span class="n">kn</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">treeNodes</span><span class="p">):</span>
            <span class="c1"># print(&quot;* [{}] &lt;{} ({})&gt;&quot;.format(node.depth, node.task.getId(), node.task.getElementName()))</span>
            <span class="c1"># print(nodeStack)</span>
            <span class="n">taskType</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">getTypeCode</span><span class="p">()</span>

            <span class="c1"># Create information for task</span>
            <span class="c1"># We are going down in the tree</span>
            <span class="k">if</span> <span class="n">taskType</span> <span class="o">==</span> <span class="n">libsedml</span><span class="o">.</span><span class="n">SEDML_TASK_REPEATEDTASK</span><span class="p">:</span>
                <span class="n">taskLines</span> <span class="o">=</span> <span class="n">SEDMLCodeFactory</span><span class="o">.</span><span class="n">repeatedTaskToPython</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="n">node</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">taskType</span> <span class="o">==</span> <span class="n">libsedml</span><span class="o">.</span><span class="n">SEDML_TASK</span><span class="p">:</span>
                <span class="n">tid</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
                <span class="n">taskLines</span> <span class="o">=</span> <span class="n">SEDMLCodeFactory</span><span class="o">.</span><span class="n">simpleTaskToPython</span><span class="p">(</span><span class="n">doc</span><span class="o">=</span><span class="n">doc</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="n">node</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;# Unsupported task: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">taskType</span><span class="p">))</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Unsupported task: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">taskType</span><span class="p">))</span>

            <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;    &quot;</span><span class="o">*</span><span class="n">node</span><span class="o">.</span><span class="n">depth</span> <span class="o">+</span> <span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">taskLines</span><span class="p">])</span>

            <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            @staticmethod</span>
<span class="sd">            def simpleTaskToPython(doc, task):</span>
<span class="sd">                &quot;&quot;&quot; Create python for simple task. &quot;&quot;&quot;</span>
<span class="sd">                for ksub, subtask in enumerate(subtasks):</span>
<span class="sd">                    t = doc.getTask(subtask.getTask())</span>

<span class="sd">                    resultVariable = &quot;__subtask__&quot;.format(t.getId())</span>
<span class="sd">                    selections = SEDMLCodeFactory.selectionsForTask(doc=doc, task=task)</span>
<span class="sd">                    if t.getTypeCode() == libsedml.SEDML_TASK:</span>
<span class="sd">                        forLines.extend(SEDMLCodeFactory.subtaskToPython(doc, task=t,</span>
<span class="sd">                                                                  selections=selections,</span>
<span class="sd">                                                                  resultVariable=resultVariable))</span>
<span class="sd">                        forLines.append(&quot;{}.extend([__subtask__])&quot;.format(task.getId()))</span>

<span class="sd">                    elif t.getTypeCode() == libsedml.SEDML_TASK_REPEATEDTASK:</span>
<span class="sd">                        forLines.extend(SEDMLCodeFactory.repeatedTaskToPython(doc, task=t))</span>
<span class="sd">                        forLines.append(&quot;{}.extend({})&quot;.format(task.getId(), t.getId()))</span>
<span class="sd">            &#39;&#39;&#39;</span>

            <span class="c1"># Collect information</span>
            <span class="c1"># We have to go back up</span>
            <span class="c1"># Look at next node in the treeNodes (this is the next one to write)</span>
            <span class="k">if</span> <span class="n">kn</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">treeNodes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">nextNode</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nextNode</span> <span class="o">=</span> <span class="n">treeNodes</span><span class="p">[</span><span class="n">kn</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>

            <span class="c1"># The next node is further up in the tree, or there is no next node</span>
            <span class="c1"># and still nodes on the stack</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">nextNode</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">nextNode</span><span class="o">.</span><span class="n">depth</span> <span class="o">&lt;</span> <span class="n">node</span><span class="o">.</span><span class="n">depth</span><span class="p">):</span>
                <span class="c1"># if (nextNode is None):</span>
                <span class="c1">#     print(&#39;last node&#39;)</span>
                <span class="c1"># else:</span>
                <span class="c1">#     print(&#39;nextNode higher&#39;)</span>

                <span class="c1"># necessary to pop nodes from the stack and close the code</span>
                <span class="n">test</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">while</span> <span class="n">test</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
                    <span class="c1"># stack is empty</span>
                    <span class="k">if</span> <span class="n">nodeStack</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">test</span> <span class="o">=</span> <span class="bp">False</span>
                        <span class="k">continue</span>
                    <span class="c1"># try to pop next one</span>
                    <span class="n">peek</span> <span class="o">=</span> <span class="n">nodeStack</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">nextNode</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">peek</span><span class="o">.</span><span class="n">depth</span> <span class="o">&gt;</span> <span class="n">nextNode</span><span class="o">.</span><span class="n">depth</span><span class="p">):</span>
                        <span class="c1"># TODO: reset evaluation has to be defined here</span>
                        <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
                            <span class="s2">&quot;&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;    &quot;</span><span class="o">*</span><span class="n">node</span><span class="o">.</span><span class="n">depth</span> <span class="o">+</span> <span class="s2">&quot;{}.extend({})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">peek</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="n">node</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">getId</span><span class="p">()),</span>
                        <span class="p">])</span>
                        <span class="n">node</span> <span class="o">=</span> <span class="n">nodeStack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                        <span class="c1"># print(&quot;pop:&quot;, peek.info())</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">test</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># we are going done or next subtask -&gt; put node on stack</span>
                <span class="n">nodeStack</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="c1"># print(&quot;push:&quot;, node.info())</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SEDMLCodeFactory.simpleTaskToPython"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.SEDMLCodeFactory.simpleTaskToPython">[docs]</a>    <span class="k">def</span> <span class="nf">simpleTaskToPython</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Creates the simulation python code for a given taskNode.</span>

<span class="sd">        The taskNodes are required to handle the relationships between</span>
<span class="sd">        RepeatedTasks, SubTasks and SimpleTasks (Task).</span>

<span class="sd">        :param doc: sedml document</span>
<span class="sd">        :type doc: SEDDocument</span>
<span class="sd">        :param node: taskNode of the current task</span>
<span class="sd">        :type node: TaskNode</span>
<span class="sd">        :return:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">task</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">task</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;# Task: &lt;{}&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">getId</span><span class="p">()))</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;{} = [None]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">getId</span><span class="p">()))</span>

        <span class="n">mid</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">getModelReference</span><span class="p">()</span>
        <span class="n">sid</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">getSimulationReference</span><span class="p">()</span>
        <span class="n">simulation</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">getSimulation</span><span class="p">(</span><span class="n">sid</span><span class="p">)</span>

        <span class="n">simType</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">getTypeCode</span><span class="p">()</span>
        <span class="n">algorithm</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">getAlgorithm</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">algorithm</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Algorithm missing on simulation, defaulting to &#39;cvode: KISAO:0000019&#39;&quot;</span><span class="p">)</span>
            <span class="n">algorithm</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">createAlgorithm</span><span class="p">()</span>
            <span class="n">algorithm</span><span class="o">.</span><span class="n">setKisaoID</span><span class="p">(</span><span class="s2">&quot;KISAO:0000019&quot;</span><span class="p">)</span>
        <span class="n">kisao</span> <span class="o">=</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">getKisaoID</span><span class="p">()</span>

        <span class="c1"># is supported algorithm</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">SEDMLCodeFactory</span><span class="o">.</span><span class="n">isSupportedAlgorithmForSimulationType</span><span class="p">(</span><span class="n">kisao</span><span class="o">=</span><span class="n">kisao</span><span class="p">,</span> <span class="n">simType</span><span class="o">=</span><span class="n">simType</span><span class="p">):</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;# Unsupported Algorithm {} for SimulationType {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kisao</span><span class="p">,</span> <span class="n">simulation</span><span class="o">.</span><span class="n">getElementName</span><span class="p">()))</span>
            <span class="k">return</span> <span class="n">lines</span>

        <span class="c1"># set integrator/solver</span>
        <span class="n">integratorName</span> <span class="o">=</span> <span class="n">SEDMLCodeFactory</span><span class="o">.</span><span class="n">getIntegratorNameForKisaoID</span><span class="p">(</span><span class="n">kisao</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">integratorName</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;No integrator exists for {} in roadrunner&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kisao</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">lines</span>

        <span class="k">if</span> <span class="n">simType</span> <span class="ow">is</span> <span class="n">libsedml</span><span class="o">.</span><span class="n">SEDML_SIMULATION_STEADYSTATE</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;{}.setSteadyStateSolver(&#39;{}&#39;)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="n">integratorName</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;{}.setIntegrator(&#39;{}&#39;)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="n">integratorName</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">kisao</span> <span class="o">==</span> <span class="s2">&quot;KISAO:0000288&quot;</span><span class="p">:</span>  <span class="c1"># BDF</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;{}.integrator.setValue(&#39;{}&#39;, {})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="s1">&#39;stiff&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">kisao</span> <span class="o">==</span> <span class="s2">&quot;KISAO:0000280&quot;</span><span class="p">:</span>  <span class="c1"># Adams-Moulton</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;{}.integrator.setValue(&#39;{}&#39;, {})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="s1">&#39;stiff&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>

        <span class="c1"># integrator/solver settings (AlgorithmParameters)</span>
        <span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">getListOfAlgorithmParameters</span><span class="p">():</span>
            <span class="n">pkey</span> <span class="o">=</span> <span class="n">SEDMLCodeFactory</span><span class="o">.</span><span class="n">algorithmParameterToParameterKey</span><span class="p">(</span><span class="n">par</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pkey</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;&#39;{}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pkey</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">pkey</span><span class="o">.</span><span class="n">value</span>

            <span class="k">if</span> <span class="n">simType</span> <span class="ow">is</span> <span class="n">libsedml</span><span class="o">.</span><span class="n">SEDML_SIMULATION_STEADYSTATE</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;{}.steadyStateSolver.setValue(&#39;{}&#39;, {})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="n">pkey</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;{}.integrator.setValue(&#39;{}&#39;, {})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="n">pkey</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">simType</span> <span class="ow">is</span> <span class="n">libsedml</span><span class="o">.</span><span class="n">SEDML_SIMULATION_STEADYSTATE</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;{}.conservedMoietyAnalysis = True&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mid</span><span class="p">))</span>

        <span class="c1"># get parents</span>
        <span class="n">parents</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">parent</span>
        <span class="k">while</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">parents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">parent</span>

        <span class="c1"># &lt;selections&gt; of all parents</span>
        <span class="c1"># ---------------------------</span>
        <span class="n">selections</span> <span class="o">=</span> <span class="n">SEDMLCodeFactory</span><span class="o">.</span><span class="n">selectionsForTask</span><span class="p">(</span><span class="n">doc</span><span class="o">=</span><span class="n">doc</span><span class="p">,</span> <span class="n">task</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">task</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parents</span><span class="p">:</span>
            <span class="n">selections</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">SEDMLCodeFactory</span><span class="o">.</span><span class="n">selectionsForTask</span><span class="p">(</span><span class="n">doc</span><span class="o">=</span><span class="n">doc</span><span class="p">,</span> <span class="n">task</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">task</span><span class="p">))</span>

        <span class="c1"># &lt;setValues&gt; of all parents</span>
        <span class="c1"># ---------------------------</span>
        <span class="c1"># apply changes based on current variables, parameters and range variables</span>
        <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">parents</span><span class="p">):</span>
            <span class="n">rangeId</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">getRangeId</span><span class="p">()</span>
            <span class="n">helperRanges</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">parent</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">getListOfRanges</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span> <span class="o">!=</span> <span class="n">rangeId</span><span class="p">:</span>
                    <span class="n">helperRanges</span><span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">getId</span><span class="p">()]</span> <span class="o">=</span> <span class="n">r</span>

            <span class="k">for</span> <span class="n">setValue</span> <span class="ow">in</span> <span class="n">parent</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">getListOfTaskChanges</span><span class="p">():</span>
                <span class="n">variables</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="c1"># range variables</span>
                <span class="n">variables</span><span class="p">[</span><span class="n">rangeId</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;__value__{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rangeId</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">helperRanges</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">variables</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;__value__{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="c1"># parameters</span>
                <span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="n">setValue</span><span class="o">.</span><span class="n">getListOfParameters</span><span class="p">():</span>
                    <span class="n">variables</span><span class="p">[</span><span class="n">par</span><span class="o">.</span><span class="n">getId</span><span class="p">()]</span> <span class="o">=</span> <span class="n">par</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">setValue</span><span class="o">.</span><span class="n">getListOfVariables</span><span class="p">():</span>
                    <span class="n">vid</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
                    <span class="n">mid</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">getModelReference</span><span class="p">()</span>
                    <span class="n">selection</span> <span class="o">=</span> <span class="n">SEDMLCodeFactory</span><span class="o">.</span><span class="n">resolveSelectionFromVariable</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
                    <span class="n">variables</span><span class="p">[</span><span class="n">vid</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;__value__{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vid</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;species&quot;</span><span class="p">:</span>
                        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;__value__{} = {}[&#39;[{}]&#39;]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vid</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">selection</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;__value__{} = {}[&#39;{}&#39;]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vid</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">selection</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>

                <span class="c1"># value is calculated with the current state of model</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">evaluableMathML</span><span class="p">(</span><span class="n">setValue</span><span class="o">.</span><span class="n">getMath</span><span class="p">(),</span> <span class="n">variables</span><span class="o">=</span><span class="n">variables</span><span class="p">)</span>
                <span class="n">xpath</span> <span class="o">=</span> <span class="n">setValue</span><span class="o">.</span><span class="n">getTarget</span><span class="p">()</span>
                <span class="n">mid</span> <span class="o">=</span> <span class="n">setValue</span><span class="o">.</span><span class="n">getModelReference</span><span class="p">()</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SEDMLCodeFactory</span><span class="o">.</span><span class="n">targetToPython</span><span class="p">(</span><span class="n">xpath</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">modelId</span><span class="o">=</span><span class="n">mid</span><span class="p">))</span>

        <span class="c1"># handle result variable</span>
        <span class="n">resultVariable</span> <span class="o">=</span> <span class="s2">&quot;{}[0]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">getId</span><span class="p">())</span>

        <span class="c1"># -------------------------------------------------------------------------</span>
        <span class="c1"># &lt;UNIFORM TIMECOURSE&gt;</span>
        <span class="c1"># -------------------------------------------------------------------------</span>
        <span class="k">if</span> <span class="n">simType</span> <span class="o">==</span> <span class="n">libsedml</span><span class="o">.</span><span class="n">SEDML_SIMULATION_UNIFORMTIMECOURSE</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;{}.timeCourseSelections = {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">selections</span><span class="p">)))</span>

            <span class="n">initialTime</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">getInitialTime</span><span class="p">()</span>
            <span class="n">outputStartTime</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">getOutputStartTime</span><span class="p">()</span>
            <span class="n">outputEndTime</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">getOutputEndTime</span><span class="p">()</span>
            <span class="n">numberOfPoints</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">getNumberOfPoints</span><span class="p">()</span>

            <span class="c1"># throw some points away</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">outputStartTime</span> <span class="o">-</span> <span class="n">initialTime</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1E-6</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;{}.simulate(start={}, end={}, points=2)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                    <span class="n">mid</span><span class="p">,</span> <span class="n">initialTime</span><span class="p">,</span> <span class="n">outputStartTime</span><span class="p">))</span>
            <span class="c1"># real simulation</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;{} = {}.simulate(start={}, end={}, steps={})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                    <span class="n">resultVariable</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">outputStartTime</span><span class="p">,</span> <span class="n">outputEndTime</span><span class="p">,</span> <span class="n">numberOfPoints</span><span class="p">))</span>
        <span class="c1"># -------------------------------------------------------------------------</span>
        <span class="c1"># &lt;ONESTEP&gt;</span>
        <span class="c1"># -------------------------------------------------------------------------</span>
        <span class="k">elif</span> <span class="n">simType</span> <span class="o">==</span> <span class="n">libsedml</span><span class="o">.</span><span class="n">SEDML_SIMULATION_ONESTEP</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;{}.timeCourseSelections = {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">selections</span><span class="p">)))</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">getStep</span><span class="p">()</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;{} = {}.simulate(start={}, end={}, points=2)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resultVariable</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">step</span><span class="p">))</span>

        <span class="c1"># -------------------------------------------------------------------------</span>
        <span class="c1"># &lt;STEADY STATE&gt;</span>
        <span class="c1"># -------------------------------------------------------------------------</span>
        <span class="k">elif</span> <span class="n">simType</span> <span class="o">==</span> <span class="n">libsedml</span><span class="o">.</span><span class="n">SEDML_SIMULATION_STEADYSTATE</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;{}.steadyStateSelections = {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">selections</span><span class="p">)))</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;{}.simulate()&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mid</span><span class="p">))</span>  <span class="c1"># for stability of the steady state solver</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;{} = {}.steadyState()&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resultVariable</span><span class="p">,</span> <span class="n">mid</span><span class="p">))</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;{}.conservedMoietyAnalysis = False&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mid</span><span class="p">))</span>

        <span class="c1"># -------------------------------------------------------------------------</span>
        <span class="c1"># &lt;OTHER&gt;</span>
        <span class="c1"># -------------------------------------------------------------------------</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;# Unsupported simulation: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">simType</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">lines</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SEDMLCodeFactory.repeatedTaskToPython"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.SEDMLCodeFactory.repeatedTaskToPython">[docs]</a>    <span class="k">def</span> <span class="nf">repeatedTaskToPython</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create python for RepeatedTask.</span>

<span class="sd">        Must create</span>
<span class="sd">        - the ranges (Ranges)</span>
<span class="sd">        - apply all changes (SetValues)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># storage of results</span>
        <span class="n">task</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">task</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;{} = []&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">getId</span><span class="p">())]</span>

        <span class="c1"># &lt;Range Definition&gt;</span>
        <span class="c1"># master range</span>
        <span class="n">rangeId</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">getRangeId</span><span class="p">()</span>
        <span class="n">masterRange</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">getRange</span><span class="p">(</span><span class="n">rangeId</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">masterRange</span><span class="o">.</span><span class="n">getTypeCode</span><span class="p">()</span> <span class="o">==</span> <span class="n">libsedml</span><span class="o">.</span><span class="n">SEDML_RANGE_UNIFORMRANGE</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">SEDMLCodeFactory</span><span class="o">.</span><span class="n">uniformRangeToPython</span><span class="p">(</span><span class="n">masterRange</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">masterRange</span><span class="o">.</span><span class="n">getTypeCode</span><span class="p">()</span> <span class="o">==</span> <span class="n">libsedml</span><span class="o">.</span><span class="n">SEDML_RANGE_VECTORRANGE</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">SEDMLCodeFactory</span><span class="o">.</span><span class="n">vectorRangeToPython</span><span class="p">(</span><span class="n">masterRange</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">masterRange</span><span class="o">.</span><span class="n">getTypeCode</span><span class="p">()</span> <span class="o">==</span> <span class="n">libsedml</span><span class="o">.</span><span class="n">SEDML_RANGE_FUNCTIONALRANGE</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;FunctionalRange for master range not supported in task.&quot;</span><span class="p">)</span>
        <span class="c1"># lock-in ranges</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">task</span><span class="o">.</span><span class="n">getListOfRanges</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span> <span class="o">!=</span> <span class="n">rangeId</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">getTypeCode</span><span class="p">()</span> <span class="o">==</span> <span class="n">libsedml</span><span class="o">.</span><span class="n">SEDML_RANGE_UNIFORMRANGE</span><span class="p">:</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">SEDMLCodeFactory</span><span class="o">.</span><span class="n">uniformRangeToPython</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">r</span><span class="o">.</span><span class="n">getTypeCode</span><span class="p">()</span> <span class="o">==</span> <span class="n">libsedml</span><span class="o">.</span><span class="n">SEDML_RANGE_VECTORRANGE</span><span class="p">:</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">SEDMLCodeFactory</span><span class="o">.</span><span class="n">vectorRangeToPython</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>

        <span class="c1"># &lt;Range Iteration&gt;</span>
        <span class="c1"># iterate master range</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;for __k__{}, __value__{} in enumerate(__range__{}):&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rangeId</span><span class="p">,</span> <span class="n">rangeId</span><span class="p">,</span> <span class="n">rangeId</span><span class="p">))</span>

        <span class="c1"># Everything from now on is done in every iteration of the range</span>
        <span class="c1"># We have to collect &amp; intent all lines in the loop)</span>
        <span class="n">forLines</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># definition of lock-in ranges</span>
        <span class="n">helperRanges</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">task</span><span class="o">.</span><span class="n">getListOfRanges</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span> <span class="o">!=</span> <span class="n">rangeId</span><span class="p">:</span>
                <span class="n">helperRanges</span><span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">getId</span><span class="p">()]</span> <span class="o">=</span> <span class="n">r</span>
                <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">getTypeCode</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="n">libsedml</span><span class="o">.</span><span class="n">SEDML_RANGE_UNIFORMRANGE</span><span class="p">,</span>
                                       <span class="n">libsedml</span><span class="o">.</span><span class="n">SEDML_RANGE_VECTORRANGE</span><span class="p">]:</span>
                    <span class="n">forLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;__value__{} = __range__{}[__k__{}]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="n">r</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="n">rangeId</span><span class="p">))</span>

                <span class="c1"># &lt;functional range&gt;</span>
                <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">getTypeCode</span><span class="p">()</span> <span class="o">==</span> <span class="n">libsedml</span><span class="o">.</span><span class="n">SEDML_RANGE_FUNCTIONALRANGE</span><span class="p">:</span>
                    <span class="n">variables</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="c1"># range variables</span>
                    <span class="n">variables</span><span class="p">[</span><span class="n">rangeId</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;__value__{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rangeId</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">helperRanges</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">variables</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;__value__{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                    <span class="c1"># parameters</span>
                    <span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">getListOfParameters</span><span class="p">():</span>
                        <span class="n">variables</span><span class="p">[</span><span class="n">par</span><span class="o">.</span><span class="n">getId</span><span class="p">()]</span> <span class="o">=</span> <span class="n">par</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">getListOfVariables</span><span class="p">():</span>
                        <span class="n">vid</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
                        <span class="n">mid</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">getModelReference</span><span class="p">()</span>
                        <span class="n">selection</span> <span class="o">=</span> <span class="n">SEDMLCodeFactory</span><span class="o">.</span><span class="n">resolveSelectionFromVariable</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
                        <span class="n">variables</span><span class="p">[</span><span class="n">vid</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;__value__{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vid</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;species&quot;</span><span class="p">:</span>
                            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;__value__{} = {}[&#39;[{}]&#39;]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vid</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">selection</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;__value__{} = {}[&#39;{}&#39;]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vid</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">selection</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>

                    <span class="c1"># value is calculated with the current state of model</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">evaluableMathML</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">getMath</span><span class="p">(),</span> <span class="n">variables</span><span class="o">=</span><span class="n">variables</span><span class="p">)</span>
                    <span class="n">forLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;__value__{} = {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="n">value</span><span class="p">))</span>

        <span class="c1"># &lt;resetModels&gt;</span>
        <span class="c1"># models to reset via task tree below node</span>
        <span class="n">mids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">task</span>
            <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">getTypeCode</span><span class="p">()</span> <span class="o">==</span> <span class="n">libsedml</span><span class="o">.</span><span class="n">SEDML_TASK</span><span class="p">:</span>
                <span class="n">mids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">getModelReference</span><span class="p">())</span>
        <span class="c1"># reset models referenced in tree below task</span>
        <span class="k">for</span> <span class="n">mid</span> <span class="ow">in</span> <span class="n">mids</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">task</span><span class="o">.</span><span class="n">getResetModel</span><span class="p">():</span>
                <span class="c1"># reset before every iteration</span>
                <span class="n">forLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;{}.reset()&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mid</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># reset before first iteration</span>
                <span class="n">forLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;if __k__{} == 0:&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rangeId</span><span class="p">))</span>
                <span class="n">forLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;    {}.reset()&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mid</span><span class="p">))</span>

        <span class="c1"># add lines</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="s1">&#39;    &#39;</span> <span class="o">+</span> <span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">forLines</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">lines</span></div>

    <span class="c1">################################################################################################</span>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SEDMLCodeFactory.getDataGeneratorsForTask"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.SEDMLCodeFactory.getDataGeneratorsForTask">[docs]</a>    <span class="k">def</span> <span class="nf">getDataGeneratorsForTask</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">task</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get the DataGenerators which reference the given task.</span>

<span class="sd">        :param doc:</span>
<span class="sd">        :type doc:</span>
<span class="sd">        :param task:</span>
<span class="sd">        :type task:</span>
<span class="sd">        :return:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dgs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">dg</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">getListOfDataGenerators</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">dg</span><span class="o">.</span><span class="n">getListOfVariables</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">getTaskReference</span><span class="p">()</span> <span class="o">==</span> <span class="n">task</span><span class="o">.</span><span class="n">getId</span><span class="p">():</span>
                    <span class="n">dgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dg</span><span class="p">)</span>
                    <span class="k">break</span>  <span class="c1"># the DataGenerator is added, no need to look at rest of variables</span>
        <span class="k">return</span> <span class="n">dgs</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SEDMLCodeFactory.selectionsForTask"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.SEDMLCodeFactory.selectionsForTask">[docs]</a>    <span class="k">def</span> <span class="nf">selectionsForTask</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">task</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Populate variable lists from the data generators for the given task.</span>

<span class="sd">        These are the timeCourseSelections and steadyStateSelections</span>
<span class="sd">        in RoadRunner.</span>

<span class="sd">        Search all data generators for variables which have to be part of the simulation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">selections</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">dg</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">getListOfDataGenerators</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">dg</span><span class="o">.</span><span class="n">getListOfVariables</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">getTaskReference</span><span class="p">()</span> <span class="o">==</span> <span class="n">task</span><span class="o">.</span><span class="n">getId</span><span class="p">():</span>
                    <span class="n">sel</span> <span class="o">=</span> <span class="n">SEDMLCodeFactory</span><span class="o">.</span><span class="n">resolveSelectionFromVariable</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
                    <span class="n">selections</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">sel</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">selections</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SEDMLCodeFactory.uniformRangeToPython"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.SEDMLCodeFactory.uniformRangeToPython">[docs]</a>    <span class="k">def</span> <span class="nf">uniformRangeToPython</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create python lines for uniform range.</span>
<span class="sd">        :param r:</span>
<span class="sd">        :type r:</span>
<span class="sd">        :return:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">rId</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
        <span class="n">rStart</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">getStart</span><span class="p">()</span>
        <span class="n">rEnd</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">getEnd</span><span class="p">()</span>
        <span class="n">rPoints</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">getNumberOfPoints</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span>  <span class="c1"># One point more than number of points</span>
        <span class="n">rType</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">rType</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Linear&#39;</span><span class="p">,</span> <span class="s1">&#39;linear&#39;</span><span class="p">]:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;__range__{} = np.linspace(start={}, stop={}, num={})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rId</span><span class="p">,</span> <span class="n">rStart</span><span class="p">,</span> <span class="n">rEnd</span><span class="p">,</span> <span class="n">rPoints</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">rType</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Log&#39;</span><span class="p">,</span> <span class="s1">&#39;log&#39;</span><span class="p">]:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;__range__{} = np.logspace(start={}, stop={}, num={})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rId</span><span class="p">,</span> <span class="n">rStart</span><span class="p">,</span> <span class="n">rEnd</span><span class="p">,</span> <span class="n">rPoints</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Unsupported range type in UniformRange: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rType</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">lines</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SEDMLCodeFactory.vectorRangeToPython"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.SEDMLCodeFactory.vectorRangeToPython">[docs]</a>    <span class="k">def</span> <span class="nf">vectorRangeToPython</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">__range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">getNumValues</span><span class="p">()])</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">getValues</span><span class="p">()):</span>
            <span class="n">__range</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;__range__{} = {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="nb">list</span><span class="p">(</span><span class="n">__range</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">lines</span></div>


    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SEDMLCodeFactory.resolveSelectionFromVariable"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.SEDMLCodeFactory.resolveSelectionFromVariable">[docs]</a>    <span class="k">def</span> <span class="nf">resolveSelectionFromVariable</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Resolve the model target to model identifier.</span>

<span class="sd">        :param var:</span>
<span class="sd">        :type var: SedVariable</span>
<span class="sd">        :return:</span>
<span class="sd">        :rtype: Target</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Selection</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;Selection&#39;</span><span class="p">,</span> <span class="s1">&#39;id type&#39;</span><span class="p">)</span>

        <span class="c1"># symbol field of variable is set</span>
        <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">isSetSymbol</span><span class="p">():</span>
            <span class="n">cvs</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">getSymbol</span><span class="p">()</span>
            <span class="n">astr</span> <span class="o">=</span> <span class="n">cvs</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;symbol:&quot;</span><span class="p">)</span>
            <span class="n">sid</span> <span class="o">=</span> <span class="n">astr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">Selection</span><span class="p">(</span><span class="n">sid</span><span class="p">,</span> <span class="s1">&#39;symbol&#39;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">var</span><span class="o">.</span><span class="n">isSetTarget</span><span class="p">():</span>
            <span class="n">cvt</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">getTarget</span><span class="p">()</span>    <span class="c1"># target field of variable is set</span>
            <span class="n">astr</span> <span class="o">=</span> <span class="n">cvt</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;@id=&#39;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">astr</span><span class="p">)</span> <span class="ow">is</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">astr</span> <span class="o">=</span> <span class="n">cvt</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;@name=&#39;&quot;</span><span class="p">)</span>
            <span class="n">astr</span> <span class="o">=</span> <span class="n">astr</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">astr</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">sid</span> <span class="o">=</span> <span class="n">astr</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;species&#39;</span> <span class="ow">in</span> <span class="n">cvt</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Selection</span><span class="p">(</span><span class="s1">&#39;[{}]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sid</span><span class="p">),</span> <span class="s1">&#39;species&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;parameter&#39;</span> <span class="ow">in</span> <span class="n">cvt</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Selection</span><span class="p">(</span><span class="n">sid</span><span class="p">,</span> <span class="s1">&#39;parameter&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Selection</span><span class="p">(</span><span class="n">sid</span><span class="p">,</span> <span class="s1">&#39;other&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Unrecognized Selection in variable&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SEDMLCodeFactory.isSupportedAlgorithmForSimulationType"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.SEDMLCodeFactory.isSupportedAlgorithmForSimulationType">[docs]</a>    <span class="k">def</span> <span class="nf">isSupportedAlgorithmForSimulationType</span><span class="p">(</span><span class="n">kisao</span><span class="p">,</span> <span class="n">simType</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check Algorithm Kisao Id is supported for simulation.</span>

<span class="sd">        :return: is supported</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">supported</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">simType</span> <span class="o">==</span> <span class="n">libsedml</span><span class="o">.</span><span class="n">SEDML_SIMULATION_UNIFORMTIMECOURSE</span><span class="p">:</span>
            <span class="n">supported</span> <span class="o">=</span> <span class="n">KISAOS_UNIFORMTIMECOURSE</span>
        <span class="k">elif</span> <span class="n">simType</span> <span class="o">==</span> <span class="n">libsedml</span><span class="o">.</span><span class="n">SEDML_SIMULATION_ONESTEP</span><span class="p">:</span>
            <span class="n">supported</span> <span class="o">=</span> <span class="n">KISAOS_ONESTEP</span>
        <span class="k">elif</span> <span class="n">simType</span> <span class="o">==</span> <span class="n">libsedml</span><span class="o">.</span><span class="n">SEDML_SIMULATION_STEADYSTATE</span><span class="p">:</span>
            <span class="n">supported</span> <span class="o">=</span> <span class="n">KISAOS_STEADYSTATE</span>
        <span class="k">return</span> <span class="n">kisao</span> <span class="ow">in</span> <span class="n">supported</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SEDMLCodeFactory.getIntegratorNameForKisaoID"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.SEDMLCodeFactory.getIntegratorNameForKisaoID">[docs]</a>    <span class="k">def</span> <span class="nf">getIntegratorNameForKisaoID</span><span class="p">(</span><span class="n">kid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; RoadRunner integrator name for algorithm KisaoID.</span>

<span class="sd">        :param kid: KisaoID</span>
<span class="sd">        :type kid: str</span>
<span class="sd">        :return: RoadRunner integrator name.</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">kid</span> <span class="ow">in</span> <span class="n">KISAOS_NLEQ</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;nleq&#39;</span>
        <span class="k">if</span> <span class="n">kid</span> <span class="ow">in</span> <span class="n">KISAOS_CVODE</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;cvode&#39;</span>
        <span class="k">if</span> <span class="n">kid</span> <span class="ow">in</span> <span class="n">KISAOS_GILLESPIE</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;gillespie&#39;</span>
        <span class="k">if</span> <span class="n">kid</span> <span class="ow">in</span> <span class="n">KISAOS_RK4</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;rk4&#39;</span>
        <span class="k">if</span> <span class="n">kid</span> <span class="ow">in</span> <span class="n">KISAOS_RK45</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;rk45&#39;</span>
        <span class="k">return</span> <span class="bp">None</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SEDMLCodeFactory.algorithmParameterToParameterKey"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.SEDMLCodeFactory.algorithmParameterToParameterKey">[docs]</a>    <span class="k">def</span> <span class="nf">algorithmParameterToParameterKey</span><span class="p">(</span><span class="n">par</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Resolve the mapping between parameter keys and roadrunner integrator keys.&quot;&quot;&quot;</span>
        <span class="n">ParameterKey</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;ParameterKey&#39;</span><span class="p">,</span> <span class="s1">&#39;key value dtype&#39;</span><span class="p">)</span>
        <span class="n">kid</span> <span class="o">=</span> <span class="n">par</span><span class="o">.</span><span class="n">getKisaoID</span><span class="p">()</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">par</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">kid</span> <span class="ow">in</span> <span class="n">KISAOS_ALGORITHMPARAMETERS</span><span class="p">:</span>
            <span class="c1"># algorithm parameter is in the list of parameters</span>
            <span class="n">key</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">KISAOS_ALGORITHMPARAMETERS</span><span class="p">[</span><span class="n">kid</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span>
                <span class="c1"># transform manually ! (otherwise all strings give True)</span>
                <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;true&#39;</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">elif</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;false&#39;</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># cast to data type of parameter</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">dtype</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ParameterKey</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># algorithm parameter not supported</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Unsupported AlgorithmParameter: {} = {})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kid</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
            <span class="k">return</span> <span class="bp">None</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SEDMLCodeFactory.targetToPython"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.SEDMLCodeFactory.targetToPython">[docs]</a>    <span class="k">def</span> <span class="nf">targetToPython</span><span class="p">(</span><span class="n">xpath</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">modelId</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Creates python line for given xpath target and value.</span>
<span class="sd">        :param xpath:</span>
<span class="sd">        :type xpath:</span>
<span class="sd">        :param value:</span>
<span class="sd">        :type value:</span>
<span class="sd">        :return:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">SEDMLCodeFactory</span><span class="o">.</span><span class="n">resolveTargetFromXPath</span><span class="p">(</span><span class="n">xpath</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;# Unsupported target: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xpath</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># parameter value change</span>
            <span class="k">if</span> <span class="n">target</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;parameter&quot;</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;{}[&#39;{}&#39;] = {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">modelId</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
            <span class="c1"># species concentration change</span>
            <span class="k">elif</span> <span class="n">target</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;species&quot;</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;{}[&#39;init([{}])&#39;] = {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">modelId</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
            <span class="c1"># unknown</span>
            <span class="k">elif</span> <span class="n">target</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;unknown&quot;</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;{}[&#39;{}&#39;] = {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">modelId</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;# Unsupported target: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xpath</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">line</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SEDMLCodeFactory.resolveTargetFromXPath"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.SEDMLCodeFactory.resolveTargetFromXPath">[docs]</a>    <span class="k">def</span> <span class="nf">resolveTargetFromXPath</span><span class="p">(</span><span class="n">xpath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Resolve the model target to model identifier.</span>

<span class="sd">        :param xpath:</span>
<span class="sd">        :type xpath:</span>
<span class="sd">        :return:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># FIXME: getting of sids, pids not very robust, handle more cases (rules, reactions, ...)</span>
        <span class="n">Target</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;Target&#39;</span><span class="p">,</span> <span class="s1">&#39;id type&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">getId</span><span class="p">(</span><span class="n">xpath</span><span class="p">):</span>
            <span class="n">xpath</span> <span class="o">=</span> <span class="n">xpath</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">r&quot;id=&#39;(.*?)&#39;&quot;</span><span class="p">,</span> <span class="n">xpath</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">match</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="p">)</span> <span class="ow">is</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Xpath could not be resolved: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xpath</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># parameter value change</span>
        <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;model&quot;</span> <span class="ow">in</span> <span class="n">xpath</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;parameter&quot;</span> <span class="ow">in</span> <span class="n">xpath</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Target</span><span class="p">(</span><span class="n">getId</span><span class="p">(</span><span class="n">xpath</span><span class="p">),</span> <span class="s1">&#39;parameter&#39;</span><span class="p">)</span>
        <span class="c1"># species concentration change</span>
        <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;model&quot;</span> <span class="ow">in</span> <span class="n">xpath</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;species&quot;</span> <span class="ow">in</span> <span class="n">xpath</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Target</span><span class="p">(</span><span class="n">getId</span><span class="p">(</span><span class="n">xpath</span><span class="p">),</span> <span class="s1">&#39;species&#39;</span><span class="p">)</span>
        <span class="c1"># other</span>
        <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;model&quot;</span> <span class="ow">in</span> <span class="n">xpath</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;id&quot;</span> <span class="ow">in</span> <span class="n">xpath</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Target</span><span class="p">(</span><span class="n">getId</span><span class="p">(</span><span class="n">xpath</span><span class="p">),</span> <span class="s1">&#39;unknown&#39;</span><span class="p">)</span>
        <span class="c1"># cannot be parsed</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Unsupported target: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xpath</span><span class="p">))</span>
            <span class="k">return</span> <span class="bp">None</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SEDMLCodeFactory.dataGeneratorToPython"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.SEDMLCodeFactory.dataGeneratorToPython">[docs]</a>    <span class="k">def</span> <span class="nf">dataGeneratorToPython</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">generator</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create variable from the data generators and the simulations.</span>

<span class="sd">            The data of repeatedTasks is handled differently depending</span>
<span class="sd">            on if reset=True or reset=False.</span>
<span class="sd">            reset=True:</span>
<span class="sd">                every repeat is a single curve, i.e. the data is a list of data</span>
<span class="sd">            reset=False:</span>
<span class="sd">                all curves belong to a single simulation and are concatenated to one dataset</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">gid</span> <span class="o">=</span> <span class="n">generator</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
        <span class="n">mathml</span> <span class="o">=</span> <span class="n">generator</span><span class="o">.</span><span class="n">getMath</span><span class="p">()</span>

        <span class="c1"># create variables</span>
        <span class="n">variables</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="n">generator</span><span class="o">.</span><span class="n">getListOfParameters</span><span class="p">():</span>
            <span class="n">variables</span><span class="p">[</span><span class="n">par</span><span class="o">.</span><span class="n">getId</span><span class="p">()]</span> <span class="o">=</span> <span class="n">par</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">generator</span><span class="o">.</span><span class="n">getListOfVariables</span><span class="p">():</span>
            <span class="n">varId</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
            <span class="n">variables</span><span class="p">[</span><span class="n">varId</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;__var__{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">varId</span><span class="p">)</span>

        <span class="c1"># create python for variables</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">generator</span><span class="o">.</span><span class="n">getListOfVariables</span><span class="p">():</span>
            <span class="n">varId</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
            <span class="n">taskId</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">getTaskReference</span><span class="p">()</span>
            <span class="n">task</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">getTask</span><span class="p">(</span><span class="n">taskId</span><span class="p">)</span>

            <span class="n">selection</span> <span class="o">=</span> <span class="n">SEDMLCodeFactory</span><span class="o">.</span><span class="n">resolveSelectionFromVariable</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
            <span class="n">isTime</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="n">selection</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;symbol&quot;</span> <span class="ow">and</span> <span class="n">selection</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span>
                <span class="n">isTime</span> <span class="o">=</span> <span class="bp">True</span>

            <span class="n">resetModel</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="n">task</span><span class="o">.</span><span class="n">getTypeCode</span><span class="p">()</span> <span class="o">==</span> <span class="n">libsedml</span><span class="o">.</span><span class="n">SEDML_TASK_REPEATEDTASK</span><span class="p">:</span>
                <span class="n">resetModel</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">getResetModel</span><span class="p">()</span>

            <span class="c1"># Series of curves</span>

            <span class="k">if</span> <span class="n">resetModel</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;__var__{} = np.transpose(np.array([sim[&#39;{}&#39;] for sim in {}]))&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">varId</span><span class="p">,</span> <span class="n">selection</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">taskId</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># One curve via time adjusted concatenate</span>
                <span class="k">if</span> <span class="n">isTime</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;__offsets__{} = np.cumsum(np.array([sim[&#39;{}&#39;][-1] for sim in {}]))&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">taskId</span><span class="p">,</span> <span class="n">selection</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">taskId</span><span class="p">))</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;__offsets__{} = np.insert(__offsets__{}, 0, 0)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">taskId</span><span class="p">,</span> <span class="n">taskId</span><span class="p">))</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;__var__{} = np.transpose(np.array([sim[&#39;{}&#39;]+__offsets__{}[k] for k, sim in enumerate({})]))&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">varId</span><span class="p">,</span> <span class="n">selection</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">taskId</span><span class="p">,</span> <span class="n">taskId</span><span class="p">))</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;__var__{} = np.concatenate(np.transpose(__var__{}))&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">varId</span><span class="p">,</span> <span class="n">varId</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;__var__{} = np.transpose(np.array([sim[&#39;{}&#39;] for sim in {}]))&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">varId</span><span class="p">,</span> <span class="n">selection</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">taskId</span><span class="p">))</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;__var__{} = np.concatenate(np.transpose(__var__{}))&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">varId</span><span class="p">,</span> <span class="n">varId</span><span class="p">))</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;if len(__var__{}.shape) == 1:&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">varId</span><span class="p">))</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;     __var__{}.shape += (1,)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">varId</span><span class="p">))</span>

        <span class="c1"># calculate data generator</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">evaluableMathML</span><span class="p">(</span><span class="n">mathml</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="n">variables</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;{} = {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gid</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SEDMLCodeFactory.outputToPython"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.SEDMLCodeFactory.outputToPython">[docs]</a>    <span class="k">def</span> <span class="nf">outputToPython</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">output</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create output &quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">typeCode</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">getTypeCode</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">typeCode</span> <span class="o">==</span> <span class="n">libsedml</span><span class="o">.</span><span class="n">SEDML_OUTPUT_REPORT</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">SEDMLCodeFactory</span><span class="o">.</span><span class="n">outputReportToPython</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">output</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">typeCode</span> <span class="o">==</span> <span class="n">libsedml</span><span class="o">.</span><span class="n">SEDML_OUTPUT_PLOT2D</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">SEDMLCodeFactory</span><span class="o">.</span><span class="n">outputPlot2DToPython</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">output</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">typeCode</span> <span class="o">==</span> <span class="n">libsedml</span><span class="o">.</span><span class="n">SEDML_OUTPUT_PLOT3D</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">SEDMLCodeFactory</span><span class="o">.</span><span class="n">outputPlot3DToPython</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">output</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;# Unsupported output type: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">getElementName</span><span class="p">()))</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SEDMLCodeFactory.outputReportToPython"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.SEDMLCodeFactory.outputReportToPython">[docs]</a>    <span class="k">def</span> <span class="nf">outputReportToPython</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">output</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; OutputReport</span>

<span class="sd">        :param doc:</span>
<span class="sd">        :type doc: SedDocument</span>
<span class="sd">        :param output:</span>
<span class="sd">        :type output: SedOutputReport</span>
<span class="sd">        :return: list of python lines</span>
<span class="sd">        :rtype: list(str)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">headers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dgIds</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">dataSet</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">getListOfDataSets</span><span class="p">():</span>
            <span class="c1"># these are the columns</span>
            <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataSet</span><span class="o">.</span><span class="n">getLabel</span><span class="p">())</span>
            <span class="c1"># data generator (the id is the id of the data in python)</span>
            <span class="n">dgId</span> <span class="o">=</span> <span class="n">dataSet</span><span class="o">.</span><span class="n">getDataReference</span><span class="p">()</span>
            <span class="n">dgIds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dgId</span><span class="p">)</span>
            <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;{}[:,k]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dgId</span><span class="p">))</span>
        <span class="c1"># create data frames for the repeats</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;__dfs__{} = []&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">getId</span><span class="p">()))</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;for k in range({}.shape[1]):&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dgIds</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;    print(&#39;-&#39;*80)&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;    print(&#39;{}, Repeat:&#39;, k)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">getId</span><span class="p">()))</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;    print(&#39;-&#39;*80)&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;    __df__k = pandas.DataFrame(np.column_stack(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;), </span><span class="se">\n</span><span class="s2">    columns=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;    print(__df__k.head(5))&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;    __dfs__{}.append(__df__k)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">getId</span><span class="p">()))</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;    __df__k.to_csv(os.path.join(workingDir, &#39;{}_{{}}.csv&#39;.format(k)), sep=&#39;</span><span class="se">\t</span><span class="s2">&#39;, index=False)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">getId</span><span class="p">()))</span>
        <span class="k">return</span> <span class="n">lines</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SEDMLCodeFactory.outputPlotSettings"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.SEDMLCodeFactory.outputPlotSettings">[docs]</a>    <span class="k">def</span> <span class="nf">outputPlotSettings</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot; Settings for all plot types.</span>

<span class="sd">        :return:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">PlotSettings</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;PlotSettings&#39;</span><span class="p">,</span> <span class="s1">&#39;colors, figsize, dpi, facecolor, edgecolor, linewidth, markersize, alpha&#39;</span><span class="p">)</span>

        <span class="c1"># all lines of same cuve have same color</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="n">PlotSettings</span><span class="p">(</span>
            <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s1">u&#39;r&#39;</span><span class="p">,</span> <span class="s1">u&#39;b&#39;</span><span class="p">,</span> <span class="s1">u&#39;g&#39;</span><span class="p">,</span> <span class="s1">u&#39;m&#39;</span><span class="p">,</span> <span class="s1">u&#39;c&#39;</span><span class="p">,</span> <span class="s1">u&#39;y&#39;</span><span class="p">,</span> <span class="s1">u&#39;k&#39;</span><span class="p">],</span>
            <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
            <span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span>
            <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
            <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">settings</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SEDMLCodeFactory.outputPlot2DToPython"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.SEDMLCodeFactory.outputPlot2DToPython">[docs]</a>    <span class="k">def</span> <span class="nf">outputPlot2DToPython</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">output</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; OutputReport</span>

<span class="sd">        If workingDir is provided the plot is saved in the workingDir.</span>
<span class="sd">        :param doc:</span>
<span class="sd">        :type doc: SedDocument</span>
<span class="sd">        :param output:</span>
<span class="sd">        :type output: SedOutputReport</span>
<span class="sd">        :return: list of python lines</span>
<span class="sd">        :rtype: list(str)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: handle mix of log and linear axis</span>
        <span class="c1"># TODO: display range information in Legend|TextBox (than it is clear in Figure what was iterated)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="n">SEDMLCodeFactory</span><span class="o">.</span><span class="n">outputPlotSettings</span><span class="p">()</span>

        <span class="n">title</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">isSetName</span><span class="p">():</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span>

        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;plt.figure(num=None, figsize={}, dpi={}, facecolor=&#39;{}&#39;, edgecolor=&#39;{}&#39;)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">figsize</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">dpi</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">facecolor</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">edgecolor</span><span class="p">))</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;from matplotlib import gridspec&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;__gs = gridspec.GridSpec(1, 2, width_ratios=[3, 1])&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;plt.subplot(__gs[0])&quot;</span><span class="p">)</span>

        <span class="n">oneXLabel</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">allXLabel</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="n">kc</span><span class="p">,</span> <span class="n">curve</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">getListOfCurves</span><span class="p">()):</span>
            <span class="n">logX</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">getLogX</span><span class="p">()</span>
            <span class="n">logY</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">getLogY</span><span class="p">()</span>
            <span class="n">xId</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">getXDataReference</span><span class="p">()</span>
            <span class="n">yId</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">getYDataReference</span><span class="p">()</span>
            <span class="n">dgx</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">getDataGenerator</span><span class="p">(</span><span class="n">xId</span><span class="p">)</span>
            <span class="n">dgy</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">getDataGenerator</span><span class="p">(</span><span class="n">yId</span><span class="p">)</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">kc</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">colors</span><span class="p">)]</span>

            <span class="n">yLabel</span> <span class="o">=</span> <span class="n">yId</span>
            <span class="k">if</span> <span class="n">curve</span><span class="o">.</span><span class="n">isSetName</span><span class="p">():</span>
                <span class="n">yLabel</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">dgy</span><span class="o">.</span><span class="n">isSetName</span><span class="p">():</span>
                <span class="n">yLabel</span> <span class="o">=</span> <span class="n">dgy</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span>
            <span class="n">xLabel</span> <span class="o">=</span> <span class="n">xId</span>
            <span class="k">if</span> <span class="n">dgx</span><span class="o">.</span><span class="n">isSetName</span><span class="p">():</span>
                <span class="n">xLabel</span> <span class="o">=</span> <span class="n">dgx</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span>

            <span class="c1"># do all curves have the same xLabel</span>
            <span class="k">if</span> <span class="n">kc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">allXLabel</span> <span class="o">=</span> <span class="n">xLabel</span>
            <span class="k">elif</span> <span class="n">xLabel</span> <span class="o">!=</span> <span class="n">allXLabel</span><span class="p">:</span>
                <span class="n">oneXLabel</span> <span class="o">=</span> <span class="bp">False</span>

            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;for k in range({}.shape[1]):&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xId</span><span class="p">))</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;    if k == 0:&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;        plt.plot({}[:,k], {}[:,k], &#39;-o&#39;, color=&#39;{}&#39;, linewidth={}, markersize={}, alpha={}, label=&#39;{}&#39;)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xId</span><span class="p">,</span> <span class="n">yId</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">markersize</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span> <span class="n">yLabel</span><span class="p">))</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;    else:&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;        plt.plot({}[:,k], {}[:,k], &#39;-o&#39;, color=&#39;{}&#39;, linewidth={}, markersize={}, alpha={})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xId</span><span class="p">,</span> <span class="n">yId</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">markersize</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">alpha</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">logX</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;plt.xscale(&#39;log&#39;)&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">logY</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;plt.yscale(&#39;log&#39;)&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;plt.title(&#39;{}&#39;, fontweight=&#39;bold&#39;)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">title</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">oneXLabel</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;plt.xlabel(&#39;{}&#39;, fontweight=&#39;bold&#39;)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xLabel</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">getListOfCurves</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;plt.ylabel(&#39;{}&#39;, fontweight=&#39;bold&#39;)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">yLabel</span><span class="p">))</span>

        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;__lg = plt.legend(bbox_to_anchor=(1.05, 1), loc=2, borderaxespad=0.)&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;__lg.draw_frame(False)&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;plt.setp(__lg.get_texts(), fontsize=&#39;small&#39;)&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;plt.setp(__lg.get_texts(), fontweight=&#39;bold&#39;)&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;plt.savefig(os.path.join(workingDir, &#39;{}.png&#39;), dpi=100)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">getId</span><span class="p">()))</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;plt.show()&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">title</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">lines</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SEDMLCodeFactory.outputPlot3DToPython"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.SEDMLCodeFactory.outputPlot3DToPython">[docs]</a>    <span class="k">def</span> <span class="nf">outputPlot3DToPython</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">output</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; OutputPlot3D</span>

<span class="sd">        :param doc:</span>
<span class="sd">        :type doc: SedDocument</span>
<span class="sd">        :param output:</span>
<span class="sd">        :type output: SedOutputPlot3D</span>
<span class="sd">        :return: list of python lines</span>
<span class="sd">        :rtype: list(str)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: handle mix of log and linear axis</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="n">SEDMLCodeFactory</span><span class="o">.</span><span class="n">outputPlotSettings</span><span class="p">()</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;from mpl_toolkits.mplot3d import Axes3D&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;fig = plt.figure(num=None, figsize={}, dpi={}, facecolor=&#39;{}&#39;, edgecolor=&#39;{}&#39;)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">figsize</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">dpi</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">facecolor</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">edgecolor</span><span class="p">))</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;from matplotlib import gridspec&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;__gs = gridspec.GridSpec(1, 2, width_ratios=[3, 1])&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;ax = plt.subplot(__gs[0], projection=&#39;3d&#39;)&quot;</span><span class="p">)</span>
        <span class="c1"># lines.append(&quot;ax = fig.gca(projection=&#39;3d&#39;)&quot;)</span>

        <span class="n">title</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">isSetName</span><span class="p">():</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span>

        <span class="n">oneXLabel</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">oneYLabel</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">allXLabel</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">allYLabel</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">for</span> <span class="n">kc</span><span class="p">,</span> <span class="n">surf</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">getListOfSurfaces</span><span class="p">()):</span>
            <span class="n">logX</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">getLogX</span><span class="p">()</span>
            <span class="n">logY</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">getLogY</span><span class="p">()</span>
            <span class="n">logZ</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">getLogZ</span><span class="p">()</span>
            <span class="n">xId</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">getXDataReference</span><span class="p">()</span>
            <span class="n">yId</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">getYDataReference</span><span class="p">()</span>
            <span class="n">zId</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">getZDataReference</span><span class="p">()</span>
            <span class="n">dgx</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">getDataGenerator</span><span class="p">(</span><span class="n">xId</span><span class="p">)</span>
            <span class="n">dgy</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">getDataGenerator</span><span class="p">(</span><span class="n">yId</span><span class="p">)</span>
            <span class="n">dgz</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">getDataGenerator</span><span class="p">(</span><span class="n">zId</span><span class="p">)</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">kc</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">colors</span><span class="p">)]</span>

            <span class="n">zLabel</span> <span class="o">=</span> <span class="n">zId</span>
            <span class="k">if</span> <span class="n">surf</span><span class="o">.</span><span class="n">isSetName</span><span class="p">():</span>
                <span class="n">zLabel</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">dgy</span><span class="o">.</span><span class="n">isSetName</span><span class="p">():</span>
                <span class="n">zLabel</span> <span class="o">=</span> <span class="n">dgz</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span>

            <span class="n">xLabel</span> <span class="o">=</span> <span class="n">xId</span>
            <span class="k">if</span> <span class="n">dgx</span><span class="o">.</span><span class="n">isSetName</span><span class="p">():</span>
                <span class="n">xLabel</span> <span class="o">=</span> <span class="n">dgx</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span>
            <span class="n">yLabel</span> <span class="o">=</span> <span class="n">yId</span>
            <span class="k">if</span> <span class="n">dgy</span><span class="o">.</span><span class="n">isSetName</span><span class="p">():</span>
                <span class="n">yLabel</span> <span class="o">=</span> <span class="n">dgy</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span>

            <span class="c1"># do all curves have the same xLabel &amp; yLabel</span>
            <span class="k">if</span> <span class="n">kc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">allXLabel</span> <span class="o">=</span> <span class="n">xLabel</span>
                <span class="n">allYLabel</span> <span class="o">=</span> <span class="n">yLabel</span>
            <span class="k">if</span> <span class="n">xLabel</span> <span class="o">!=</span> <span class="n">allXLabel</span><span class="p">:</span>
                <span class="n">oneXLabel</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="n">yLabel</span> <span class="o">!=</span> <span class="n">allYLabel</span><span class="p">:</span>
                <span class="n">oneYLabel</span> <span class="o">=</span> <span class="bp">False</span>

            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;for k in range({}.shape[1]):&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xId</span><span class="p">))</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;    if k == 0:&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;        ax.plot({}[:,k], {}[:,k], {}[:,k], &#39;-o&#39;, color=&#39;{}&#39;, linewidth=1.5, markersize=4.0, alpha=0.8, label=&#39;{}&#39;)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xId</span><span class="p">,</span> <span class="n">yId</span><span class="p">,</span> <span class="n">zId</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">zLabel</span><span class="p">))</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;    else:&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;        ax.plot({}[:,k], {}[:,k], {}[:,k], &#39;-o&#39;, color=&#39;{}&#39;, linewidth=1.5, markersize=4.0, alpha=0.8)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xId</span><span class="p">,</span> <span class="n">yId</span><span class="p">,</span> <span class="n">zId</span><span class="p">,</span> <span class="n">color</span><span class="p">))</span>

        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;ax.set_title(&#39;{}&#39;, fontweight=&#39;bold&#39;)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">title</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">oneXLabel</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;ax.set_xlabel(&#39;{}&#39;, fontweight=&#39;bold&#39;)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xLabel</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">oneYLabel</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;ax.set_ylabel(&#39;{}&#39;, fontweight=&#39;bold&#39;)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">yLabel</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">getListOfSurfaces</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;ax.set_zlabel(&#39;{}&#39;, fontweight=&#39;bold&#39;)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zLabel</span><span class="p">))</span>

        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;__lg = plt.legend(bbox_to_anchor=(1.05, 1), loc=2, borderaxespad=0.)&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;__lg.draw_frame(False)&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;plt.setp(__lg.get_texts(), fontsize=&#39;small&#39;)&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;plt.setp(__lg.get_texts(), fontweight=&#39;bold&#39;)&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;plt.tick_params(axis=&#39;both&#39;, which=&#39;major&#39;, labelsize=10)&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;plt.tick_params(axis=&#39;both&#39;, which=&#39;minor&#39;, labelsize=8)&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;plt.savefig(os.path.join(workingDir, &#39;{}.png&#39;), dpi=100)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">getId</span><span class="p">()))</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;plt.show()&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">title</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">lines</span></div></div>


<span class="c1">##################################################################################################</span>
<div class="viewcode-block" id="SEDMLTools"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.SEDMLTools">[docs]</a><span class="k">class</span> <span class="nc">SEDMLTools</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Helper functions to work with sedml. &quot;&quot;&quot;</span>

    <span class="n">INPUT_TYPE_STR</span> <span class="o">=</span> <span class="s1">&#39;SEDML_STRING&#39;</span>
    <span class="n">INPUT_TYPE_FILE_SEDML</span> <span class="o">=</span> <span class="s1">&#39;SEDML_FILE&#39;</span>
    <span class="n">INPUT_TYPE_FILE_COMBINE</span> <span class="o">=</span> <span class="s1">&#39;COMBINE_FILE&#39;</span>  <span class="c1"># includes .sedx archives</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="SEDMLTools.checkSEDMLDocument"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.SEDMLTools.checkSEDMLDocument">[docs]</a>    <span class="k">def</span> <span class="nf">checkSEDMLDocument</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">doc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Checks the SedDocument for errors.</span>
<span class="sd">        Raises IOError if error exists.</span>
<span class="sd">        :param doc:</span>
<span class="sd">        :type doc:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">doc</span><span class="o">.</span><span class="n">getErrorLog</span><span class="p">()</span><span class="o">.</span><span class="n">getNumFailsWithSeverity</span><span class="p">(</span><span class="n">libsedml</span><span class="o">.</span><span class="n">LIBSEDML_SEV_ERROR</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">libsedml</span><span class="o">.</span><span class="n">writeSedMLToString</span><span class="p">(</span><span class="n">doc</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">getErrorLog</span><span class="p">()</span><span class="o">.</span><span class="n">toString</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">doc</span><span class="o">.</span><span class="n">getErrorLog</span><span class="p">()</span><span class="o">.</span><span class="n">getNumFailsWithSeverity</span><span class="p">(</span><span class="n">libsedml</span><span class="o">.</span><span class="n">LIBSEDML_SEV_FATAL</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">libsedml</span><span class="o">.</span><span class="n">writeSedMLToString</span><span class="p">(</span><span class="n">doc</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">getErrorLog</span><span class="p">()</span><span class="o">.</span><span class="n">toString</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">doc</span><span class="o">.</span><span class="n">getErrorLog</span><span class="p">()</span><span class="o">.</span><span class="n">getNumFailsWithSeverity</span><span class="p">(</span><span class="n">libsedml</span><span class="o">.</span><span class="n">LIBSEDML_SEV_WARNING</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">getErrorLog</span><span class="p">()</span><span class="o">.</span><span class="n">toString</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">doc</span><span class="o">.</span><span class="n">getErrorLog</span><span class="p">()</span><span class="o">.</span><span class="n">getNumFailsWithSeverity</span><span class="p">(</span><span class="n">libsedml</span><span class="o">.</span><span class="n">LIBSEDML_SEV_SCHEMA_ERROR</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">getErrorLog</span><span class="p">()</span><span class="o">.</span><span class="n">toString</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">doc</span><span class="o">.</span><span class="n">getErrorLog</span><span class="p">()</span><span class="o">.</span><span class="n">getNumFailsWithSeverity</span><span class="p">(</span><span class="n">libsedml</span><span class="o">.</span><span class="n">LIBSEDML_SEV_GENERAL_WARNING</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">getErrorLog</span><span class="p">()</span><span class="o">.</span><span class="n">toString</span><span class="p">())</span></div>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="SEDMLTools.readSEDMLDocument"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.SEDMLTools.readSEDMLDocument">[docs]</a>    <span class="k">def</span> <span class="nf">readSEDMLDocument</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">inputStr</span><span class="p">,</span> <span class="n">workingDir</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Parses SedMLDocument from given input.</span>

<span class="sd">        :return: dictionary of SedDocument, inputType and working directory.</span>
<span class="sd">        :rtype: {doc, inputType, workingDir}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inputStr</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;SED-ML input is not instance of basestring:&quot;</span><span class="p">,</span> <span class="n">inputStr</span><span class="p">)</span>

        <span class="c1"># SEDML-String</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">inputStr</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">from</span> <span class="nn">xml.etree</span> <span class="kn">import</span> <span class="n">ElementTree</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">inputStr</span><span class="p">)</span>
                <span class="c1"># is parsable xml string</span>
                <span class="n">doc</span> <span class="o">=</span> <span class="n">libsedml</span><span class="o">.</span><span class="n">readSedMLFromString</span><span class="p">(</span><span class="n">inputStr</span><span class="p">)</span>
                <span class="n">inputType</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">INPUT_TYPE_STR</span>
                <span class="k">if</span> <span class="n">workingDir</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">workingDir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>

            <span class="k">except</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">ParseError</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">inputStr</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;SED-ML String is not valid XML:&quot;</span><span class="p">,</span> <span class="n">inputStr</span><span class="p">)</span>

        <span class="c1"># SEDML-File</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filename</span><span class="p">,</span> <span class="n">extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">inputStr</span><span class="p">))</span>

            <span class="c1"># Archive</span>
            <span class="k">if</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">is_zipfile</span><span class="p">(</span><span class="n">inputStr</span><span class="p">):</span>
                <span class="n">archive</span> <span class="o">=</span> <span class="n">inputStr</span>
                <span class="n">inputType</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">INPUT_TYPE_FILE_COMBINE</span>

                <span class="c1"># in case of sedx and combine a working directory is created</span>
                <span class="c1"># in which the files are extracted</span>
                <span class="k">if</span> <span class="n">workingDir</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">workingDir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">inputStr</span><span class="p">)),</span> <span class="s1">&#39;_te_{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
                <span class="c1"># extract the archive to working directory</span>
                <span class="n">CombineTools</span><span class="o">.</span><span class="n">extractArchive</span><span class="p">(</span><span class="n">archive</span><span class="p">,</span> <span class="n">workingDir</span><span class="p">)</span>
                <span class="c1"># get SEDML files from archive</span>
                <span class="c1"># FIXME: there could be multiple SEDML files in archive (currently only first used)</span>
                <span class="n">sedmlFiles</span> <span class="o">=</span> <span class="n">CombineTools</span><span class="o">.</span><span class="n">filePathsFromExtractedArchive</span><span class="p">(</span><span class="n">workingDir</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sedmlFiles</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;No SEDML files found in archive.&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sedmlFiles</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;More than one sedml file in archive, only processing first one.&quot;</span><span class="p">)</span>
                <span class="n">doc</span> <span class="o">=</span> <span class="n">libsedml</span><span class="o">.</span><span class="n">readSedMLFromFile</span><span class="p">(</span><span class="n">sedmlFiles</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">cls</span><span class="o">.</span><span class="n">checkSEDMLDocument</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>

            <span class="c1"># SEDML single file</span>
            <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">inputStr</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">extension</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;.sedml&quot;</span><span class="p">,</span> <span class="s1">&#39;.xml&#39;</span><span class="p">]:</span>
                    <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;SEDML file should have [.sedml|.xml] extension:&quot;</span><span class="p">,</span> <span class="n">inputStr</span><span class="p">)</span>
                <span class="n">inputType</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">INPUT_TYPE_FILE_SEDML</span>
                <span class="n">doc</span> <span class="o">=</span> <span class="n">libsedml</span><span class="o">.</span><span class="n">readSedMLFromFile</span><span class="p">(</span><span class="n">inputStr</span><span class="p">)</span>
                <span class="n">cls</span><span class="o">.</span><span class="n">checkSEDMLDocument</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
                <span class="c1"># working directory is where the sedml file is</span>
                <span class="k">if</span> <span class="n">workingDir</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">workingDir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">inputStr</span><span class="p">))</span>

        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;doc&#39;</span><span class="p">:</span> <span class="n">doc</span><span class="p">,</span>
                <span class="s1">&#39;inputType&#39;</span><span class="p">:</span> <span class="n">inputType</span><span class="p">,</span>
                <span class="s1">&#39;workingDir&#39;</span><span class="p">:</span> <span class="n">workingDir</span><span class="p">}</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SEDMLTools.resolveModelChanges"><a class="viewcode-back" href="../../../_apidoc/tellurium.sedml.html#tellurium.sedml.tesedml.SEDMLTools.resolveModelChanges">[docs]</a>    <span class="k">def</span> <span class="nf">resolveModelChanges</span><span class="p">(</span><span class="n">doc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Resolves the original source model and full change lists for models.</span>

<span class="sd">         Going through the tree of model upwards until root is reached and</span>
<span class="sd">         collecting changes on the way (example models m* and changes c*)</span>
<span class="sd">         m1 (source) -&gt; m2 (c1, c2) -&gt; m3 (c3, c4)</span>
<span class="sd">         resolves to</span>
<span class="sd">         m1 (source) []</span>
<span class="sd">         m2 (source) [c1,c2]</span>
<span class="sd">         m3 (source) [c1,c2,c3,c4]</span>
<span class="sd">         The order of changes is important (at least between nodes on different</span>
<span class="sd">         levels of hierarchies), because later changes of derived models could</span>
<span class="sd">         reverse earlier changes.</span>

<span class="sd">         Uses recursive search strategy, which should be okay as long as the model tree hierarchy is</span>
<span class="sd">         not getting to big.</span>
<span class="sd">         &quot;&quot;&quot;</span>
        <span class="c1"># initial dicts (handle source &amp; change information for single node)</span>
        <span class="n">model_sources</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">model_changes</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">getListOfModels</span><span class="p">():</span>
            <span class="n">mid</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
            <span class="n">source</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">getSource</span><span class="p">()</span>
            <span class="n">model_sources</span><span class="p">[</span><span class="n">mid</span><span class="p">]</span> <span class="o">=</span> <span class="n">source</span>
            <span class="n">changes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># store the changes unique for this model</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">getListOfChanges</span><span class="p">():</span>
                <span class="n">changes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="n">model_changes</span><span class="p">[</span><span class="n">mid</span><span class="p">]</span> <span class="o">=</span> <span class="n">changes</span>

        <span class="c1"># recursive search for original model and store the</span>
        <span class="c1"># changes which have to be applied in the list of changes</span>
        <span class="k">def</span> <span class="nf">findSource</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="n">changes</span><span class="p">):</span>

            <span class="c1"># mid is node above</span>
            <span class="k">if</span> <span class="n">mid</span> <span class="ow">in</span> <span class="n">model_sources</span><span class="p">:</span>
                <span class="c1"># add changes for node</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">model_changes</span><span class="p">[</span><span class="n">mid</span><span class="p">]:</span>
                    <span class="n">changes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                <span class="c1"># keep looking deeper</span>
                <span class="k">return</span> <span class="n">findSource</span><span class="p">(</span><span class="n">model_sources</span><span class="p">[</span><span class="n">mid</span><span class="p">],</span> <span class="n">changes</span><span class="p">)</span>
            <span class="c1"># the source is no longer a key in the sources, it is the source</span>
            <span class="k">return</span> <span class="n">mid</span><span class="p">,</span> <span class="n">changes</span>

        <span class="n">all_changes</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">mids</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">getListOfModels</span><span class="p">()]</span>
        <span class="k">for</span> <span class="n">mid</span> <span class="ow">in</span> <span class="n">mids</span><span class="p">:</span>
            <span class="n">source</span><span class="p">,</span> <span class="n">changes</span> <span class="o">=</span> <span class="n">findSource</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="n">changes</span><span class="o">=</span><span class="nb">list</span><span class="p">())</span>
            <span class="n">model_sources</span><span class="p">[</span><span class="n">mid</span><span class="p">]</span> <span class="o">=</span> <span class="n">source</span>
            <span class="n">all_changes</span><span class="p">[</span><span class="n">mid</span><span class="p">]</span> <span class="o">=</span> <span class="n">changes</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">model_sources</span><span class="p">,</span> <span class="n">all_changes</span></div></div>


<span class="c1">##################################################################################################</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">os</span>
    <span class="kn">from</span> <span class="nn">tellurium.tests.testdata</span> <span class="kn">import</span> <span class="n">sedmlDir</span><span class="p">,</span> <span class="n">sedxDir</span>
    <span class="kn">import</span> <span class="nn">matplotlib</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">switch_backend</span><span class="p">(</span><span class="s2">&quot;Agg&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testInput</span><span class="p">(</span><span class="n">sedmlInput</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Test function run on inputStr. &quot;&quot;&quot;</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">sedmlInput</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">factory</span> <span class="o">=</span> <span class="n">SEDMLCodeFactory</span><span class="p">(</span><span class="n">sedmlInput</span><span class="p">)</span>

        <span class="c1"># create python file</span>
        <span class="n">python_str</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">toPython</span><span class="p">()</span>
        <span class="n">realPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">sedmlInput</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">sedmlInput</span> <span class="o">+</span> <span class="s1">&#39;.py&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">python_str</span><span class="p">)</span>

        <span class="c1"># execute python</span>
        <span class="n">factory</span><span class="o">.</span><span class="n">executePython</span><span class="p">()</span>

    <span class="c1"># testInput(os.path.join(sedmlDir, &quot;sedMLBIOM21.sedml&quot;))</span>

    <span class="c1"># Check sed-ml files</span>
    <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">sedmlDir</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">fname</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.sedml&quot;</span><span class="p">):</span>
            <span class="n">testInput</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sedmlDir</span><span class="p">,</span> <span class="n">fname</span><span class="p">))</span>

    <span class="c1"># Check sedx archives</span>
    <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">sedxDir</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">fname</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.sedx&quot;</span><span class="p">):</span>
            <span class="n">testInput</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sedxDir</span><span class="p">,</span> <span class="n">fname</span><span class="p">))</span>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, sys-bio.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'1.3.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>